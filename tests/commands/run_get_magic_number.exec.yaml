# Test command used to test hindsight feedback
# Output generated by running `make test`

command: run_strategy
args:
  strategy: get_magic_number
  args: {}
  policy: get_magic_number_default_policy
  policy_args: {}
  num_generated: 1
  budget:
    num_requests: 2
  export_browsable_trace: false
  export_raw_trace: true
  remove_timing_info: true
outcome:
  diagnostics: []
  result:
    success: true
    values:
      - 83
    spent_budget:
      num_requests: 2
      num_completions: 2
      input_tokens: 68
      output_tokens: 276
      cached_input_tokens: 0
      price: 4.78e-06
    success_nodes:
      - 6
    hindsight_feedback:
      5:
        query: AskNumber
        args: {}
        answer:
          mode: null
          content: '83'
    raw_trace:
      nodes:
        1: nested(0, $main)
        2: child(1, cands{@1})
        3: child(2, cands{@2})
        4: nested(3, cands)
        5: child(3, cands{%4})
        6: child(5, nil)
      queries:
        - node: 1
          space: cands
          answers:
            1:
              mode: null
              content: '0'
          query: AskNumber
          args:
            prefix: []
        - node: 2
          space: cands
          answers:
            2:
              mode: null
              content: '83'
          query: AskNumber
          args:
            prefix:
              - kind: oracle
                answer:
                  mode: null
                  content: '0'
              - kind: feedback
                label: parse_error
                description: Expected '83'. Please answer with 83 instead.
    log:
      - message: llm_request
        level: info
        node: 1
        space: cands
        metadata:
          hash: fd47bdbb
          query: AskNumber
          request:
            chat:
              - role: system
                content: Answer with a number and nothing else.
              - role: user
                content: '{}'
            num_completions: 1
            options: {}
      - message: llm_response
        level: info
        node: 1
        space: cands
        metadata:
          request: fd47bdbb
          response:
            outputs:
              - content: '0'
                tool_calls: []
                finish_reason: stop
            budget:
              values:
                num_requests: 1
                num_completions: 1
                input_tokens: 19
                output_tokens: 202
                cached_input_tokens: 0
                price: 1.96e-06
            log_items: []
            model_name: gpt-5-nano-2025-08-07
            usage_info:
              completion_tokens: 202
              prompt_tokens: 19
              total_tokens: 221
              completion_tokens_details:
                accepted_prediction_tokens: 0
                audio_tokens: 0
                reasoning_tokens: 192
                rejected_prediction_tokens: 0
              prompt_tokens_details:
                audio_tokens: 0
                cached_tokens: 0
          usage:
            model: gpt-5-nano-2025-08-07
            usage:
              completion_tokens: 202
              prompt_tokens: 19
              total_tokens: 221
              completion_tokens_details:
                accepted_prediction_tokens: 0
                audio_tokens: 0
                reasoning_tokens: 192
                rejected_prediction_tokens: 0
              prompt_tokens_details:
                audio_tokens: 0
                cached_tokens: 0
      - message: llm_request
        level: info
        node: 2
        space: cands
        metadata:
          hash: 49e1d018
          query: AskNumber
          request:
            chat:
              - role: system
                content: Answer with a number and nothing else.
              - role: user
                content: '{}'
              - role: assistant
                answer:
                  mode: null
                  content: '0'
              - role: user
                content: |
                  Error. Please try again.

                  """
                  Expected '83'. Please answer with 83 instead.
                  """
            num_completions: 1
            options: {}
      - message: llm_response
        level: info
        node: 2
        space: cands
        metadata:
          request: 49e1d018
          response:
            outputs:
              - content: '83'
                tool_calls: []
                finish_reason: stop
            budget:
              values:
                num_requests: 1
                num_completions: 1
                input_tokens: 49
                output_tokens: 74
                cached_input_tokens: 0
                price: 2.8199999999999997e-06
            log_items: []
            model_name: gpt-5-nano-2025-08-07
            usage_info:
              completion_tokens: 74
              prompt_tokens: 49
              total_tokens: 123
              completion_tokens_details:
                accepted_prediction_tokens: 0
                audio_tokens: 0
                reasoning_tokens: 64
                rejected_prediction_tokens: 0
              prompt_tokens_details:
                audio_tokens: 0
                cached_tokens: 0
          usage:
            model: gpt-5-nano-2025-08-07
            usage:
              completion_tokens: 74
              prompt_tokens: 49
              total_tokens: 123
              completion_tokens_details:
                accepted_prediction_tokens: 0
                audio_tokens: 0
                reasoning_tokens: 64
                rejected_prediction_tokens: 0
              prompt_tokens_details:
                audio_tokens: 0
                cached_tokens: 0
