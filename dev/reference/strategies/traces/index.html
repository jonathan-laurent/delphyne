
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../queries/">
      
      
        <link rel="next" href="../misc/">
      
      
      <link rel="icon" href="../../../None">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>References and Traces - Delphyne</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="https://unpkg.com/katex@0/dist/katex.min.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#references-and-traces" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Delphyne" class="md-header__button md-logo" aria-label="Delphyne" data-md-component="logo">
      
  <img src="../../../assets/logos/white/mini.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Delphyne
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              References and Traces
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Delphyne" class="md-nav__button md-logo" aria-label="Delphyne" data-md-component="logo">
      
  <img src="../../../assets/logos/white/mini.png" alt="logo">

    </a>
    Delphyne
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Manual
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Manual
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/strategies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Strategies and Trees
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/policies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Policies
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/demos/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Demonstrations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../manual/extension/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    VSCode Extension
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../how-to-guides/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    How-To Guides
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" checked>
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Strategy Language
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            Strategy Language
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../trees/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Trees and Spaces
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../strategies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Strategies and Reification
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../queries/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Queries and Chats
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    References and Traces
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    References and Traces
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#references-summary" class="md-nav__link">
    <span class="md-ellipsis">
      References Summary
    </span>
  </a>
  
    <nav class="md-nav" aria-label="References Summary">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs" class="md-nav__link">
    <span class="md-ellipsis">
      refs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#query-answers" class="md-nav__link">
    <span class="md-ellipsis">
      Query Answers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Query Answers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#delphyne.Answer" class="md-nav__link">
    <span class="md-ellipsis">
      Answer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.AnswerMode" class="md-nav__link">
    <span class="md-ellipsis">
      AnswerMode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.Structured" class="md-nav__link">
    <span class="md-ellipsis">
      Structured
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.ToolCall" class="md-nav__link">
    <span class="md-ellipsis">
      ToolCall
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
    <nav class="md-nav" aria-label="References">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.NodeRef" class="md-nav__link">
    <span class="md-ellipsis">
      NodeRef
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.NodePath" class="md-nav__link">
    <span class="md-ellipsis">
      NodePath
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.NodeId" class="md-nav__link">
    <span class="md-ellipsis">
      NodeId
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.ValueRef" class="md-nav__link">
    <span class="md-ellipsis">
      ValueRef
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.Assembly" class="md-nav__link">
    <span class="md-ellipsis">
      Assembly
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.AtomicValueRef" class="md-nav__link">
    <span class="md-ellipsis">
      AtomicValueRef
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.IndexedRef" class="md-nav__link">
    <span class="md-ellipsis">
      IndexedRef
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.SpaceElementRef" class="md-nav__link">
    <span class="md-ellipsis">
      SpaceElementRef
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.SpaceRef" class="md-nav__link">
    <span class="md-ellipsis">
      SpaceRef
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.SpaceName" class="md-nav__link">
    <span class="md-ellipsis">
      SpaceName
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.AnswerRef" class="md-nav__link">
    <span class="md-ellipsis">
      AnswerRef
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.AnswerId" class="md-nav__link">
    <span class="md-ellipsis">
      AnswerId
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.HintsRef" class="md-nav__link">
    <span class="md-ellipsis">
      HintsRef
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.Hint" class="md-nav__link">
    <span class="md-ellipsis">
      Hint
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.HintValue" class="md-nav__link">
    <span class="md-ellipsis">
      HintValue
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.GlobalNodePath" class="md-nav__link">
    <span class="md-ellipsis">
      GlobalNodePath
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.GlobalSpacePath" class="md-nav__link">
    <span class="md-ellipsis">
      GlobalSpacePath
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.NodeOrigin" class="md-nav__link">
    <span class="md-ellipsis">
      NodeOrigin
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.ChildOf" class="md-nav__link">
    <span class="md-ellipsis">
      ChildOf
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.NestedTreeOf" class="md-nav__link">
    <span class="md-ellipsis">
      NestedTreeOf
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tracked-values" class="md-nav__link">
    <span class="md-ellipsis">
      Tracked Values
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tracked Values">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.Tracked" class="md-nav__link">
    <span class="md-ellipsis">
      Tracked
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.Value" class="md-nav__link">
    <span class="md-ellipsis">
      Value
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.ExtAssembly" class="md-nav__link">
    <span class="md-ellipsis">
      ExtAssembly
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.check_local_value" class="md-nav__link">
    <span class="md-ellipsis">
      check_local_value
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.LocalityError" class="md-nav__link">
    <span class="md-ellipsis">
      LocalityError
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#traces" class="md-nav__link">
    <span class="md-ellipsis">
      Traces
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Traces">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#delphyne.core.traces.Trace" class="md-nav__link">
    <span class="md-ellipsis">
      Trace
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Trace">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#delphyne.core.traces.Trace.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.traces.Trace.fresh_or_cached_node_id" class="md-nav__link">
    <span class="md-ellipsis">
      fresh_or_cached_node_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.traces.Trace.fresh_or_cached_answer_id" class="md-nav__link">
    <span class="md-ellipsis">
      fresh_or_cached_answer_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.traces.Trace.register_query" class="md-nav__link">
    <span class="md-ellipsis">
      register_query
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.traces.Trace.export" class="md-nav__link">
    <span class="md-ellipsis">
      export
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.traces.Trace.check_consistency" class="md-nav__link">
    <span class="md-ellipsis">
      check_consistency
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.traces.Trace.convert_location" class="md-nav__link">
    <span class="md-ellipsis">
      convert_location
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.traces.Trace.convert_query_origin" class="md-nav__link">
    <span class="md-ellipsis">
      convert_query_origin
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.traces.Trace.convert_answer_ref" class="md-nav__link">
    <span class="md-ellipsis">
      convert_answer_ref
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.traces.Trace.convert_global_node_path" class="md-nav__link">
    <span class="md-ellipsis">
      convert_global_node_path
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.traces.Trace.convert_global_space_path" class="md-nav__link">
    <span class="md-ellipsis">
      convert_global_space_path
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.traces.Trace.expand_space_ref" class="md-nav__link">
    <span class="md-ellipsis">
      expand_space_ref
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.traces.Trace.expand_value_ref" class="md-nav__link">
    <span class="md-ellipsis">
      expand_value_ref
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.traces.Trace.expand_node_id" class="md-nav__link">
    <span class="md-ellipsis">
      expand_node_id
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.traces.QueryOrigin" class="md-nav__link">
    <span class="md-ellipsis">
      QueryOrigin
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.traces.ExportableTrace" class="md-nav__link">
    <span class="md-ellipsis">
      ExportableTrace
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.traces.ExportableQueryInfo" class="md-nav__link">
    <span class="md-ellipsis">
      ExportableQueryInfo
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.traces.NodeOriginStr" class="md-nav__link">
    <span class="md-ellipsis">
      NodeOriginStr
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.traces.Location" class="md-nav__link">
    <span class="md-ellipsis">
      Location
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.traces.ShortLocation" class="md-nav__link">
    <span class="md-ellipsis">
      ShortLocation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tracers" class="md-nav__link">
    <span class="md-ellipsis">
      Tracers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tracers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#delphyne.Tracer" class="md-nav__link">
    <span class="md-ellipsis">
      Tracer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tracer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#delphyne.Tracer.trace_node" class="md-nav__link">
    <span class="md-ellipsis">
      trace_node
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.Tracer.trace_query" class="md-nav__link">
    <span class="md-ellipsis">
      trace_query
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.Tracer.trace_answer" class="md-nav__link">
    <span class="md-ellipsis">
      trace_answer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.Tracer.log" class="md-nav__link">
    <span class="md-ellipsis">
      log
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.Tracer.export_log" class="md-nav__link">
    <span class="md-ellipsis">
      export_log
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.Tracer.export_trace" class="md-nav__link">
    <span class="md-ellipsis">
      export_trace
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.LogMessage" class="md-nav__link">
    <span class="md-ellipsis">
      LogMessage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.ExportableLogMessage" class="md-nav__link">
    <span class="md-ellipsis">
      ExportableLogMessage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.tracer_hook" class="md-nav__link">
    <span class="md-ellipsis">
      tracer_hook
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../misc/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Miscellaneous
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Policy Language
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Policy Language
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../policies/definitions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Definitions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../policies/streams/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Search Streams
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Demonstration Language
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Demonstration Language
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../demos/definitions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Definitions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../demos/interpreter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Interpreter
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Standard Library
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            Standard Library
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stdlib/basic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Basic
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stdlib/queries/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Queries
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stdlib/streams/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Streams
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stdlib/environments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Environments
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stdlib/effects/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Effects
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stdlib/algorithms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Algorithms
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stdlib/commands/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Commands
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../stdlib/experiments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Experiments
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cli/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Delphyne CLI
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#references-summary" class="md-nav__link">
    <span class="md-ellipsis">
      References Summary
    </span>
  </a>
  
    <nav class="md-nav" aria-label="References Summary">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs" class="md-nav__link">
    <span class="md-ellipsis">
      refs
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#query-answers" class="md-nav__link">
    <span class="md-ellipsis">
      Query Answers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Query Answers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#delphyne.Answer" class="md-nav__link">
    <span class="md-ellipsis">
      Answer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.AnswerMode" class="md-nav__link">
    <span class="md-ellipsis">
      AnswerMode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.Structured" class="md-nav__link">
    <span class="md-ellipsis">
      Structured
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.ToolCall" class="md-nav__link">
    <span class="md-ellipsis">
      ToolCall
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#references" class="md-nav__link">
    <span class="md-ellipsis">
      References
    </span>
  </a>
  
    <nav class="md-nav" aria-label="References">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.NodeRef" class="md-nav__link">
    <span class="md-ellipsis">
      NodeRef
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.NodePath" class="md-nav__link">
    <span class="md-ellipsis">
      NodePath
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.NodeId" class="md-nav__link">
    <span class="md-ellipsis">
      NodeId
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.ValueRef" class="md-nav__link">
    <span class="md-ellipsis">
      ValueRef
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.Assembly" class="md-nav__link">
    <span class="md-ellipsis">
      Assembly
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.AtomicValueRef" class="md-nav__link">
    <span class="md-ellipsis">
      AtomicValueRef
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.IndexedRef" class="md-nav__link">
    <span class="md-ellipsis">
      IndexedRef
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.SpaceElementRef" class="md-nav__link">
    <span class="md-ellipsis">
      SpaceElementRef
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.SpaceRef" class="md-nav__link">
    <span class="md-ellipsis">
      SpaceRef
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.SpaceName" class="md-nav__link">
    <span class="md-ellipsis">
      SpaceName
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.AnswerRef" class="md-nav__link">
    <span class="md-ellipsis">
      AnswerRef
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.AnswerId" class="md-nav__link">
    <span class="md-ellipsis">
      AnswerId
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.HintsRef" class="md-nav__link">
    <span class="md-ellipsis">
      HintsRef
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.Hint" class="md-nav__link">
    <span class="md-ellipsis">
      Hint
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.HintValue" class="md-nav__link">
    <span class="md-ellipsis">
      HintValue
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.GlobalNodePath" class="md-nav__link">
    <span class="md-ellipsis">
      GlobalNodePath
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.GlobalSpacePath" class="md-nav__link">
    <span class="md-ellipsis">
      GlobalSpacePath
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.NodeOrigin" class="md-nav__link">
    <span class="md-ellipsis">
      NodeOrigin
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.ChildOf" class="md-nav__link">
    <span class="md-ellipsis">
      ChildOf
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.NestedTreeOf" class="md-nav__link">
    <span class="md-ellipsis">
      NestedTreeOf
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tracked-values" class="md-nav__link">
    <span class="md-ellipsis">
      Tracked Values
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tracked Values">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.Tracked" class="md-nav__link">
    <span class="md-ellipsis">
      Tracked
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.Value" class="md-nav__link">
    <span class="md-ellipsis">
      Value
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.ExtAssembly" class="md-nav__link">
    <span class="md-ellipsis">
      ExtAssembly
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.check_local_value" class="md-nav__link">
    <span class="md-ellipsis">
      check_local_value
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.refs.LocalityError" class="md-nav__link">
    <span class="md-ellipsis">
      LocalityError
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#traces" class="md-nav__link">
    <span class="md-ellipsis">
      Traces
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Traces">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#delphyne.core.traces.Trace" class="md-nav__link">
    <span class="md-ellipsis">
      Trace
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Trace">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#delphyne.core.traces.Trace.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.traces.Trace.fresh_or_cached_node_id" class="md-nav__link">
    <span class="md-ellipsis">
      fresh_or_cached_node_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.traces.Trace.fresh_or_cached_answer_id" class="md-nav__link">
    <span class="md-ellipsis">
      fresh_or_cached_answer_id
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.traces.Trace.register_query" class="md-nav__link">
    <span class="md-ellipsis">
      register_query
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.traces.Trace.export" class="md-nav__link">
    <span class="md-ellipsis">
      export
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.traces.Trace.check_consistency" class="md-nav__link">
    <span class="md-ellipsis">
      check_consistency
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.traces.Trace.convert_location" class="md-nav__link">
    <span class="md-ellipsis">
      convert_location
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.traces.Trace.convert_query_origin" class="md-nav__link">
    <span class="md-ellipsis">
      convert_query_origin
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.traces.Trace.convert_answer_ref" class="md-nav__link">
    <span class="md-ellipsis">
      convert_answer_ref
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.traces.Trace.convert_global_node_path" class="md-nav__link">
    <span class="md-ellipsis">
      convert_global_node_path
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.traces.Trace.convert_global_space_path" class="md-nav__link">
    <span class="md-ellipsis">
      convert_global_space_path
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.traces.Trace.expand_space_ref" class="md-nav__link">
    <span class="md-ellipsis">
      expand_space_ref
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.traces.Trace.expand_value_ref" class="md-nav__link">
    <span class="md-ellipsis">
      expand_value_ref
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.traces.Trace.expand_node_id" class="md-nav__link">
    <span class="md-ellipsis">
      expand_node_id
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.traces.QueryOrigin" class="md-nav__link">
    <span class="md-ellipsis">
      QueryOrigin
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.traces.ExportableTrace" class="md-nav__link">
    <span class="md-ellipsis">
      ExportableTrace
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.traces.ExportableQueryInfo" class="md-nav__link">
    <span class="md-ellipsis">
      ExportableQueryInfo
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.traces.NodeOriginStr" class="md-nav__link">
    <span class="md-ellipsis">
      NodeOriginStr
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.traces.Location" class="md-nav__link">
    <span class="md-ellipsis">
      Location
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.core.traces.ShortLocation" class="md-nav__link">
    <span class="md-ellipsis">
      ShortLocation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#tracers" class="md-nav__link">
    <span class="md-ellipsis">
      Tracers
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tracers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#delphyne.Tracer" class="md-nav__link">
    <span class="md-ellipsis">
      Tracer
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tracer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#delphyne.Tracer.trace_node" class="md-nav__link">
    <span class="md-ellipsis">
      trace_node
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.Tracer.trace_query" class="md-nav__link">
    <span class="md-ellipsis">
      trace_query
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.Tracer.trace_answer" class="md-nav__link">
    <span class="md-ellipsis">
      trace_answer
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.Tracer.log" class="md-nav__link">
    <span class="md-ellipsis">
      log
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.Tracer.export_log" class="md-nav__link">
    <span class="md-ellipsis">
      export_log
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.Tracer.export_trace" class="md-nav__link">
    <span class="md-ellipsis">
      export_trace
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.LogMessage" class="md-nav__link">
    <span class="md-ellipsis">
      LogMessage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.ExportableLogMessage" class="md-nav__link">
    <span class="md-ellipsis">
      ExportableLogMessage
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#delphyne.tracer_hook" class="md-nav__link">
    <span class="md-ellipsis">
      tracer_hook
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="references-and-traces">References and Traces</h1>
<!-- Covers core.refs, core.traces -->

<h2 id="references-summary">References Summary</h2>


<div class="doc doc-object doc-module">



<h3 id="delphyne.core.refs" class="doc doc-heading">
            <span class="doc doc-object-name doc-module-name">delphyne.core.refs</span>


</h3>

    <div class="doc doc-contents first">

        <p>References to nodes, values, spaces and space elements.</p>
<p>References are serializable, immutable values that can be used to
identify nodes, spaces and values in a tree (possibly deeply nested).
References are useful for tooling and for representing serializable
traces (<a class="autorefs autorefs-internal" title="Trace" href="#delphyne.core.traces.Trace"><code>Trace</code></a>). Also, references are attached to success nodes and
query answers (<a class="autorefs autorefs-internal" title="Tracked


  
      dataclass
  " href="#delphyne.core.refs.Tracked"><code>Tracked</code></a>) so as to allow caching and enforce the
<em>locality invariant</em> (see <a class="autorefs autorefs-internal" title="Tree


  
      dataclass
  " href="../trees/#delphyne.Tree"><code>Tree</code></a>).</p>
<p><em>Local</em> references identify a node, space or space element <em>relative</em> to
a given tree node. <em>Global</em> references are expressed relative to a
single, global origin.</p>
<p>In addition, three kinds of references can be distinguished:</p>
<ul>
<li><strong>Full references</strong>: the default kind of references produced by
      <a class="autorefs autorefs-internal" title="reify" href="../strategies/#delphyne.reify"><code>reify</code></a>. Query answers are stored as strings and elements of
      spaces induced by strategies are denoted by sequences of value
      references.</li>
<li><strong>Id-based references</strong>: shorter references, where query answers and
      success values are identified by unique identifiers. This concise
      format is used for exporting traces (see <a class="autorefs autorefs-internal" title="Trace" href="#delphyne.core.traces.Trace"><code>Trace</code></a>).</li>
<li><strong>Hint-based references</strong>: query answers and success values are
      identified by sequences of <em>hints</em>. This format is used in the
      demonstration language (e.g. argument of test instruction <code>go
      compare(['', 'foo bar'])</code>) and when visualizing traces resulting
      from demonstrations.</li>
</ul>










  <div class="doc doc-children">












  </div>

    </div>

</div><h2 id="query-answers">Query Answers</h2>


<div class="doc doc-object doc-class">



<h3 id="delphyne.Answer" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">Answer</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


    <div class="doc doc-contents first">


        <p>An answer to a query.</p>
<p>It can serve as a <em>space element reference</em> if the space in question
is a query and the proposed answer correctly parses.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="delphyne.Answer.mode">mode</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="AnswerMode (delphyne.core.refs.AnswerMode)" href="#delphyne.AnswerMode">AnswerMode</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The answer mode (see <a class="autorefs autorefs-internal" title="AnswerMode" href="#delphyne.AnswerMode"><code>AnswerMode</code></a>).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="delphyne.Answer.content">content</span></code></td>
            <td>
                  <code><span title="str">str</span> | <a class="autorefs autorefs-internal" title="Structured


  
      dataclass
   (delphyne.core.refs.Structured)" href="#delphyne.Structured">Structured</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The answer content, which can be a raw string or a
structured answer (see <a class="autorefs autorefs-internal" title="Structured


  
      dataclass
  " href="#delphyne.Structured"><code>Structured</code></a>).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="delphyne.Answer.tool_calls">tool_calls</span></code></td>
            <td>
                  <code><span title="tuple">tuple</span>[<a class="autorefs autorefs-internal" title="ToolCall


  
      dataclass
   (delphyne.core.refs.ToolCall)" href="#delphyne.ToolCall">ToolCall</a>, ...]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An optional sequence of tool calls.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="delphyne.Answer.justification">justification</span></code></td>
            <td>
                  <code><span title="str">str</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional explanations for the answers, which
are not passed to the parser but can be appended at the end
of the answer in examples. In particular, this is useful
when defining queries for which the oracle is not asked to
produce a justification for its answer, but justifications
can still be provided in examples for the sake of few-shot
prompting.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>src/delphyne/core/refs.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Answer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An answer to a query.</span>

<span class="sd">    It can serve as a _space element reference_ if the space in question</span>
<span class="sd">    is a query and the proposed answer correctly parses.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        mode: The answer mode (see `AnswerMode`).</span>
<span class="sd">        content: The answer content, which can be a raw string or a</span>
<span class="sd">            structured answer (see `Structured`).</span>
<span class="sd">        tool_calls: An optional sequence of tool calls.</span>
<span class="sd">        justification: Additional explanations for the answers, which</span>
<span class="sd">            are not passed to the parser but can be appended at the end</span>
<span class="sd">            of the answer in examples. In particular, this is useful</span>
<span class="sd">            when defining queries for which the oracle is not asked to</span>
<span class="sd">            produce a justification for its answer, but justifications</span>
<span class="sd">            can still be provided in examples for the sake of few-shot</span>
<span class="sd">            prompting.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">mode</span><span class="p">:</span> <span class="n">AnswerMode</span>
    <span class="n">content</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Structured</span>
    <span class="n">tool_calls</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">ToolCall</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="p">()</span>
    <span class="n">justification</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-type_alias">



<h3 id="delphyne.AnswerMode" class="doc doc-heading">
            <span class="doc doc-object-name doc-type_alias-name">AnswerMode</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nc">AnswerMode</span> <span class="o">=</span> <span class="n"><span title="str">str</span></span> <span class="o">|</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents first">

        <p>A name for an answer mode, which can be a string or <code>None</code> (the latter
is typically used for naming default modes).</p>
<p>Queries are allowed to define multiple answer modes, each mode being
possibly associated with different settings and with a different parser.
An <a class="autorefs autorefs-internal" title="Answer


  
      dataclass
  " href="#delphyne.Answer"><code>Answer</code></a> value features the mode that must be used to parse it.</p>
    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="delphyne.Structured" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">Structured</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


    <div class="doc doc-contents first">


        <p>Wrapper for structured LLM answers.</p>
<p>Many LLM APIs allow producing JSON answers (sometimes following a
given schema) instead of plain text.</p>








              <details class="quote">
                <summary>Source code in <code>src/delphyne/core/refs.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Structured</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wrapper for structured LLM answers.</span>

<span class="sd">    Many LLM APIs allow producing JSON answers (sometimes following a</span>
<span class="sd">    given schema) instead of plain text.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">structured</span><span class="p">:</span> <span class="n">Any</span>  <span class="c1"># JSON object</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="c1"># See `ToolCall.__hash__` for explanations.</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="delphyne.ToolCall" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">ToolCall</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


    <div class="doc doc-contents first">


        <p>A tool call, usually produced by an LLM oracle.</p>
<p>Tool calls can be attached to LLM answers (see <a class="autorefs autorefs-internal" title="Answer


  
      dataclass
  " href="#delphyne.Answer"><code>Answer</code></a>).</p>








              <details class="quote">
                <summary>Source code in <code>src/delphyne/core/refs.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ToolCall</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A tool call, usually produced by an LLM oracle.</span>

<span class="sd">    Tool calls can be attached to LLM answers (see `Answer`).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">args</span><span class="p">:</span> <span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__hash__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="c1"># Tool calls need to be hashable since they are part of answers</span>
        <span class="c1"># and references. However, they can feature arbitrary JSON</span>
        <span class="c1"># objects. This, we compute a hash for the serialized value.</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div><h2 id="references">References</h2>


<div class="doc doc-object doc-type_alias">



<h3 id="delphyne.core.refs.NodeRef" class="doc doc-heading">
            <span class="doc doc-object-name doc-type_alias-name">NodeRef</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nc">NodeRef</span> <span class="o">=</span> <span class="n"><a class="autorefs autorefs-internal" title="NodePath (delphyne.core.refs.NodePath)" href="#delphyne.core.refs.NodePath">NodePath</a></span> <span class="o">|</span> <span class="n"><a class="autorefs autorefs-internal" title="NodeId


  
      dataclass
   (delphyne.core.refs.NodeId)" href="#delphyne.core.refs.NodeId">NodeId</a></span>
</code></pre></div>

    <div class="doc doc-contents first">

        <p>A node reference is either a path or a node identifier.</p>
<p>Only one of these forms may be allowed depending on the context (e.g. in
the id-based references used for exporting traces, only node identifiers
are used, while in the full references attached to trees by <a class="autorefs autorefs-internal" title="reify" href="../strategies/#delphyne.reify"><code>reify</code></a>,
only paths are used).</p>
    </div>

</div>

<div class="doc doc-object doc-type_alias">



<h3 id="delphyne.core.refs.NodePath" class="doc doc-heading">
            <span class="doc doc-object-name doc-type_alias-name">NodePath</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nc">NodePath</span> <span class="o">=</span> <span class="n"><span title="tuple">tuple</span></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="ValueRef (delphyne.core.refs.ValueRef)" href="#delphyne.core.refs.ValueRef">ValueRef</a></span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents first">

        <p>Encodes a sequence of actions leading to a node with respect to a
given root.</p>
    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="delphyne.core.refs.NodeId" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">NodeId</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


    <div class="doc doc-contents first">


        <p>Global identifier of a node within a trace.</p>








              <details class="quote">
                <summary>Source code in <code>src/delphyne/core/refs.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">NodeId</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Global identifier of a node within a trace.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-type_alias">



<h3 id="delphyne.core.refs.ValueRef" class="doc doc-heading">
            <span class="doc doc-object-name doc-type_alias-name">ValueRef</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nc">ValueRef</span> <span class="o">=</span> <span class="n"><a class="autorefs autorefs-internal" title="Assembly (delphyne.core.refs.Assembly)" href="#delphyne.core.refs.Assembly">Assembly</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="AtomicValueRef (delphyne.core.refs.AtomicValueRef)" href="#delphyne.core.refs.AtomicValueRef">AtomicValueRef</a></span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents first">

        <p>A reference to a local value, which is obtained by combining elements of
(possibly multiple) local spaces.</p>
    </div>

</div>

<div class="doc doc-object doc-type_alias">



<h3 id="delphyne.core.refs.Assembly" class="doc doc-heading">
            <span class="doc doc-object-name doc-type_alias-name">Assembly</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nc">Assembly</span> <span class="o">=</span> <span class="n"><span title="delphyne.core.refs.Assembly[T]">T</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">|</span> <span class="n"><span title="tuple">tuple</span></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="Assembly (delphyne.core.refs.Assembly)" href="#delphyne.core.refs.Assembly">Assembly</a></span><span class="p">[</span><span class="n"><span title="delphyne.core.refs.Assembly[T]">T</span></span><span class="p">],</span> <span class="o">...</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents first">

        <p>An S-expression whose atoms have type <code>T</code>.</p>
    </div>

</div>

<div class="doc doc-object doc-type_alias">



<h3 id="delphyne.core.refs.AtomicValueRef" class="doc doc-heading">
            <span class="doc doc-object-name doc-type_alias-name">AtomicValueRef</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nc">AtomicValueRef</span> <span class="o">=</span> <span class="n"><a class="autorefs autorefs-internal" title="IndexedRef


  
      dataclass
   (delphyne.core.refs.IndexedRef)" href="#delphyne.core.refs.IndexedRef">IndexedRef</a></span> <span class="o">|</span> <span class="n"><a class="autorefs autorefs-internal" title="SpaceElementRef


  
      dataclass
   (delphyne.core.refs.SpaceElementRef)" href="#delphyne.core.refs.SpaceElementRef">SpaceElementRef</a></span>
</code></pre></div>

    <div class="doc doc-contents first">

        <p>An atomic value reference is a space element reference that is indexed
zero or a finite number of times: <code>space_elt_ref[i1][i2]...[in]</code>.</p>
    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="delphyne.core.refs.IndexedRef" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">IndexedRef</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


    <div class="doc doc-contents first">


        <p>Indexing an atomic value reference.</p>








              <details class="quote">
                <summary>Source code in <code>src/delphyne/core/refs.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">IndexedRef</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Indexing an atomic value reference.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ref</span><span class="p">:</span> <span class="n">AtomicValueRef</span>
    <span class="n">index</span><span class="p">:</span> <span class="nb">int</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="delphyne.core.refs.SpaceElementRef" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">SpaceElementRef</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


    <div class="doc doc-contents first">


        <p>A reference to an element of a local space.</p>
<p>When the <code>space</code> field is <code>None</code>, the primary field is considered
instead (if it exists).</p>








              <details class="quote">
                <summary>Source code in <code>src/delphyne/core/refs.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SpaceElementRef</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A reference to an element of a local space.</span>

<span class="sd">    When the `space` field is `None`, the primary field is considered</span>
<span class="sd">    instead (if it exists).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">space</span><span class="p">:</span> <span class="n">SpaceRef</span> <span class="o">|</span> <span class="kc">None</span>
    <span class="n">element</span><span class="p">:</span> <span class="n">AnswerRef</span> <span class="o">|</span> <span class="n">NodeRef</span> <span class="o">|</span> <span class="n">HintsRef</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="delphyne.core.refs.SpaceRef" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">SpaceRef</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


    <div class="doc doc-contents first">


        <p>A reference to a specific local space.</p>
<p>The <code>arg</code> argument should be <code>()</code> for nonparametric spaces and a
n-uple for spaces parametric in n arguments. This differs from
Orakell where all parametric spaces have one argument.</p>








              <details class="quote">
                <summary>Source code in <code>src/delphyne/core/refs.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SpaceRef</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A reference to a specific local space.</span>

<span class="sd">    The `arg` argument should be `()` for nonparametric spaces and a</span>
<span class="sd">    n-uple for spaces parametric in n arguments. This differs from</span>
<span class="sd">    Orakell where all parametric spaces have one argument.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="n">SpaceName</span>
    <span class="n">args</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">ValueRef</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="delphyne.core.refs.SpaceName" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">SpaceName</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


    <div class="doc doc-contents first">


        <p>A name identifying a parametric space.</p>
<p>This name can feature integer indices. For example, <code>subs[0]</code>
denotes the first subgoal of a <a class="autorefs autorefs-internal" title="Join


  
      dataclass
  " href="../../stdlib/effects/#delphyne.stdlib.nodes.Join"><code>Join</code></a> node.</p>








              <details class="quote">
                <summary>Source code in <code>src/delphyne/core/refs.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SpaceName</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A name identifying a parametric space.</span>

<span class="sd">    This name can feature integer indices. For example, `subs[0]`</span>
<span class="sd">    denotes the first subgoal of a `Join` node.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">indices</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;SpaceName&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">SpaceName</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="p">,</span> <span class="n">index</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-type_alias">



<h3 id="delphyne.core.refs.AnswerRef" class="doc doc-heading">
            <span class="doc doc-object-name doc-type_alias-name">AnswerRef</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nc">AnswerRef</span> <span class="o">=</span> <span class="n"><a class="autorefs autorefs-internal" title="Answer


  
      dataclass
   (delphyne.core.refs.Answer)" href="#delphyne.Answer">Answer</a></span> <span class="o">|</span> <span class="n"><a class="autorefs autorefs-internal" title="AnswerId


  
      dataclass
   (delphyne.core.refs.AnswerId)" href="#delphyne.core.refs.AnswerId">AnswerId</a></span>
</code></pre></div>

    <div class="doc doc-contents first">

        <p>A reference to a query answer.</p>
    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="delphyne.core.refs.AnswerId" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">AnswerId</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


    <div class="doc doc-contents first">


        <p>The identifier to an <a class="autorefs autorefs-internal" title="Answer


  
      dataclass
  " href="#delphyne.Answer"><code>Answer</code></a> object stored within a trace.</p>








              <details class="quote">
                <summary>Source code in <code>src/delphyne/core/refs.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">AnswerId</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The identifier to an `Answer` object stored within a trace.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">id</span><span class="p">:</span> <span class="nb">int</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="delphyne.core.refs.HintsRef" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">HintsRef</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


    <div class="doc doc-contents first">


        <p>References a local space element via a sequence of hints.</p>








              <details class="quote">
                <summary>Source code in <code>src/delphyne/core/refs.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">HintsRef</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    References a local space element via a sequence of hints.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">hints</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Hint</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="delphyne.core.refs.Hint" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">Hint</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


    <div class="doc doc-contents first">


        <p>A hint for selecting a query answer.</p>
<p>A hint can be associated to a qualifier, which is the name of an
imported demonstration defining the hint.</p>








              <details class="quote">
                <summary>Source code in <code>src/delphyne/core/refs.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Hint</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A hint for selecting a query answer.</span>

<span class="sd">    A hint can be associated to a qualifier, which is the name of an</span>
<span class="sd">    imported demonstration defining the hint.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">qualifier</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span>
    <span class="n">hint</span><span class="p">:</span> <span class="n">HintValue</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-type_alias">



<h3 id="delphyne.core.refs.HintValue" class="doc doc-heading">
            <span class="doc doc-object-name doc-type_alias-name">HintValue</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nc">HintValue</span> <span class="o">=</span> <span class="n"><span title="str">str</span></span>
</code></pre></div>

    <div class="doc doc-contents first">

        <p>A string that hints at a query answer.</p>
    </div>

</div><!-- ## Global References -->



<div class="doc doc-object doc-type_alias">



<h3 id="delphyne.core.refs.GlobalNodePath" class="doc doc-heading">
            <span class="doc doc-object-name doc-type_alias-name">GlobalNodePath</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nc">GlobalNodePath</span> <span class="o">=</span> <span class="n"><span title="tuple">tuple</span></span><span class="p">[</span><span class="n"><span title="tuple">tuple</span></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="SpaceRef


  
      dataclass
   (delphyne.core.refs.SpaceRef)" href="#delphyne.core.refs.SpaceRef">SpaceRef</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" title="NodePath (delphyne.core.refs.NodePath)" href="#delphyne.core.refs.NodePath">NodePath</a></span><span class="p">],</span> <span class="o">...</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents first">

        <p>Path to a node from the global origin, as a sequence of (space to enter,
path to follow) instruction pairs.</p>
    </div>

</div>

<div class="doc doc-object doc-type_alias">



<h3 id="delphyne.core.refs.GlobalSpacePath" class="doc doc-heading">
            <span class="doc doc-object-name doc-type_alias-name">GlobalSpacePath</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nc">GlobalSpacePath</span> <span class="o">=</span> <span class="n"><span title="tuple">tuple</span></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="GlobalNodePath (delphyne.core.refs.GlobalNodePath)" href="#delphyne.core.refs.GlobalNodePath">GlobalNodePath</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" title="SpaceRef


  
      dataclass
   (delphyne.core.refs.SpaceRef)" href="#delphyne.core.refs.SpaceRef">SpaceRef</a></span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents first">

        <p>A path to a global node</p>
    </div>

</div><!-- ## Node Origins -->



<div class="doc doc-object doc-type_alias">



<h3 id="delphyne.core.refs.NodeOrigin" class="doc doc-heading">
            <span class="doc doc-object-name doc-type_alias-name">NodeOrigin</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nc">NodeOrigin</span> <span class="o">=</span> <span class="n"><a class="autorefs autorefs-internal" title="ChildOf


  
      dataclass
   (delphyne.core.refs.ChildOf)" href="#delphyne.core.refs.ChildOf">ChildOf</a></span> <span class="o">|</span> <span class="n"><a class="autorefs autorefs-internal" title="NestedTreeOf


  
      dataclass
   (delphyne.core.refs.NestedTreeOf)" href="#delphyne.core.refs.NestedTreeOf">NestedTreeOf</a></span>
</code></pre></div>

    <div class="doc doc-contents first">

        <p>Origin of a tree.</p>
<p>A tree is either the child of another tree or the root of a nested tree.
Traces can be exported as mappings from node identifiers to node origin
information featuring id-based references (see <a class="autorefs autorefs-internal" title="Trace" href="#delphyne.core.traces.Trace"><code>Trace</code></a>).</p>
    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="delphyne.core.refs.ChildOf" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">ChildOf</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


    <div class="doc doc-contents first">


        <p>The tree of interest is the child of another one.</p>








              <details class="quote">
                <summary>Source code in <code>src/delphyne/core/refs.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ChildOf</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The tree of interest is the child of another one.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">node</span><span class="p">:</span> <span class="n">NodeId</span>
    <span class="n">action</span><span class="p">:</span> <span class="n">ValueRef</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="delphyne.core.refs.NestedTreeOf" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">NestedTreeOf</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


    <div class="doc doc-contents first">


        <p>The tree of interest is the root of a tree that induces a given
space.</p>








              <details class="quote">
                <summary>Source code in <code>src/delphyne/core/refs.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">NestedTreeOf</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The tree of interest is the root of a tree that induces a given</span>
<span class="sd">    space.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">node</span><span class="p">:</span> <span class="n">NodeId</span>
    <span class="n">space</span><span class="p">:</span> <span class="n">SpaceRef</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div><h2 id="tracked-values">Tracked Values</h2>


<div class="doc doc-object doc-class">



<h3 id="delphyne.core.refs.Tracked" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">Tracked</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.Generic">Generic</span>[<span title="delphyne.core.refs.T">T</span>]</code></p>


        <p>A tracked value, which pairs a value with a reference.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="delphyne.core.refs.Tracked.value">value</span></code></td>
            <td>
                  <code><span title="delphyne.core.refs.T">T</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The value being tracked.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="delphyne.core.refs.Tracked.ref">ref</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="AtomicValueRef (delphyne.core.refs.AtomicValueRef)" href="#delphyne.core.refs.AtomicValueRef">AtomicValueRef</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A local reference to the value, relative to the node
reference by the <code>node</code> field.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="delphyne.core.refs.Tracked.node">node</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="GlobalNodePath (delphyne.core.refs.GlobalNodePath)" href="#delphyne.core.refs.GlobalNodePath">GlobalNodePath</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A global reference to the node to which the space that the
value originates from is attached. In particular, this field
is useful to check the locality invariant at runtime (e.g.,
when passing a tracked value to <code>Tree.child</code>).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="delphyne.core.refs.Tracked.type_annot">type_annot</span></code></td>
            <td>
                  <code><span title="delphyne.utils.typing.TypeAnnot">TypeAnnot</span>[<span title="delphyne.core.refs.T">T</span>] | <span title="delphyne.utils.typing.NoTypeInfo">NoTypeInfo</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An optional type annotation for the <a class="autorefs autorefs-internal" title="value" href="../../stdlib/effects/#delphyne.stdlib.nodes.value"><code>value</code></a> field.
This is mostly used for improving the rendering of values
when exporting trace information for external tools.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Tracked sequences (or pairs) can be indexed using <code>__getitem__</code>,
resulting in tracked values with <code>IndexedRef</code> references. Since
<code>__getitem__</code> is defined, tracked values are also iterable.</p>








              <details class="quote">
                <summary>Source code in <code>src/delphyne/core/refs.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Tracked</span><span class="p">(</span><span class="n">Generic</span><span class="p">[</span><span class="n">T</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A tracked value, which pairs a value with a reference.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        value: The value being tracked.</span>
<span class="sd">        ref: A local reference to the value, relative to the node</span>
<span class="sd">            reference by the `node` field.</span>
<span class="sd">        node: A global reference to the node to which the space that the</span>
<span class="sd">            value originates from is attached. In particular, this field</span>
<span class="sd">            is useful to check the locality invariant at runtime (e.g.,</span>
<span class="sd">            when passing a tracked value to `Tree.child`).</span>
<span class="sd">        type_annot: An optional type annotation for the `value` field.</span>
<span class="sd">            This is mostly used for improving the rendering of values</span>
<span class="sd">            when exporting trace information for external tools.</span>

<span class="sd">    Tracked sequences (or pairs) can be indexed using `__getitem__`,</span>
<span class="sd">    resulting in tracked values with `IndexedRef` references. Since</span>
<span class="sd">    `__getitem__` is defined, tracked values are also iterable.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">value</span><span class="p">:</span> <span class="n">T</span>
    <span class="n">ref</span><span class="p">:</span> <span class="n">AtomicValueRef</span>
    <span class="n">node</span><span class="p">:</span> <span class="n">GlobalNodePath</span>
    <span class="n">type_annot</span><span class="p">:</span> <span class="n">TypeAnnot</span><span class="p">[</span><span class="n">T</span><span class="p">]</span> <span class="o">|</span> <span class="n">NoTypeInfo</span>

    <span class="nd">@overload</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">[</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">](</span>
        <span class="bp">self</span><span class="p">:</span> <span class="s2">&quot;Tracked[tuple[A, B]]&quot;</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Tracked[A]&quot;</span><span class="p">:</span> <span class="o">...</span>

    <span class="nd">@overload</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">[</span><span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">](</span>
        <span class="bp">self</span><span class="p">:</span> <span class="s2">&quot;Tracked[tuple[A, B]]&quot;</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Tracked[B]&quot;</span><span class="p">:</span> <span class="o">...</span>

    <span class="nd">@overload</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">[</span><span class="n">U</span><span class="p">](</span>
        <span class="bp">self</span><span class="p">:</span> <span class="s2">&quot;Tracked[Sequence[U]]&quot;</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Tracked[U]&quot;</span><span class="p">:</span> <span class="o">...</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__getitem__</span><span class="p">[</span><span class="n">U</span><span class="p">](</span>
        <span class="bp">self</span><span class="p">:</span> <span class="s2">&quot;Tracked[Sequence[U] | tuple[Any, ...]]&quot;</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Tracked[U | Any]&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Tracked</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="n">index</span><span class="p">],</span>
            <span class="n">IndexedRef</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref</span><span class="p">,</span> <span class="n">index</span><span class="p">),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">,</span>
            <span class="n">insp</span><span class="o">.</span><span class="n">element_type_of_sequence_type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">type_annot</span><span class="p">,</span> <span class="n">index</span><span class="p">),</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-type_alias">



<h3 id="delphyne.core.refs.Value" class="doc doc-heading">
            <span class="doc doc-object-name doc-type_alias-name">Value</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nc">Value</span> <span class="o">=</span> <span class="n"><a class="autorefs autorefs-internal" title="ExtAssembly (delphyne.core.refs.ExtAssembly)" href="#delphyne.core.refs.ExtAssembly">ExtAssembly</a></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="Tracked


  
      dataclass
   (delphyne.core.refs.Tracked)" href="#delphyne.core.refs.Tracked">Tracked</a></span><span class="p">[</span><span class="n"><span title="typing.Any">Any</span></span><span class="p">]]</span>
</code></pre></div>

    <div class="doc doc-contents first">

        <p>An assembly of <em>local</em>, tracked values.</p>
<p>Values can serve as actions or space parameters.</p>
    </div>

</div>

<div class="doc doc-object doc-type_alias">



<h3 id="delphyne.core.refs.ExtAssembly" class="doc doc-heading">
            <span class="doc doc-object-name doc-type_alias-name">ExtAssembly</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nc">ExtAssembly</span> <span class="o">=</span> <span class="n"><span title="delphyne.core.refs.ExtAssembly[T]">T</span></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">|</span> <span class="n"><span title="collections.abc.Sequence">Sequence</span></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="ExtAssembly (delphyne.core.refs.ExtAssembly)" href="#delphyne.core.refs.ExtAssembly">ExtAssembly</a></span><span class="p">[</span><span class="n"><span title="delphyne.core.refs.ExtAssembly[T]">T</span></span><span class="p">]]</span>
</code></pre></div>

    <div class="doc doc-contents first">

        <p>Generalizing <code>Assembly</code> to allow arbitrary sequences (and not just
tuples). The distinction is important because <code>ValueRef</code> needs to be
hashable and so cannot contain lists, while <a class="autorefs autorefs-internal" title="Value" href="#delphyne.core.refs.Value"><code>Value</code></a> can contain lists.</p>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="delphyne.core.refs.check_local_value" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">check_local_value</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">check_local_value</span><span class="p">(</span><span class="n">val</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="Value (delphyne.core.refs.Value)" href="#delphyne.core.refs.Value">Value</a></span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="GlobalNodePath (delphyne.core.refs.GlobalNodePath)" href="#delphyne.core.refs.GlobalNodePath">GlobalNodePath</a></span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents first">

        <p>Raise a <code>LocalityError</code> exception if a given value is not a local
value relative to a given node.</p>


            <details class="quote">
              <summary>Source code in <code>src/delphyne/core/refs.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">check_local_value</span><span class="p">(</span><span class="n">val</span><span class="p">:</span> <span class="n">Value</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">GlobalNodePath</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Raise a `LocalityError` exception if a given value is not a local</span>
<span class="sd">    value relative to a given node.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">match</span> <span class="n">val</span><span class="p">:</span>
        <span class="k">case</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">case</span> <span class="n">Sequence</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span>
                <span class="n">check_local_value</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">node</span><span class="p">)</span>
        <span class="k">case</span> <span class="n">Tracked</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">val</span><span class="o">.</span><span class="n">node</span> <span class="o">!=</span> <span class="n">node</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">LocalityError</span><span class="p">(</span>
                    <span class="n">expected_node_ref</span><span class="o">=</span><span class="n">node</span><span class="p">,</span>
                    <span class="n">node_ref</span><span class="o">=</span><span class="n">val</span><span class="o">.</span><span class="n">node</span><span class="p">,</span>
                    <span class="n">local_ref</span><span class="o">=</span><span class="n">val</span><span class="o">.</span><span class="n">ref</span><span class="p">,</span>
                <span class="p">)</span>
        <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
            <span class="k">assert</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="delphyne.core.refs.LocalityError" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">LocalityError</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


    <div class="doc doc-contents first">
            <p class="doc doc-class-bases">
              Bases: <code><span title="Exception">Exception</span></code></p>


        <p>Exception raised when the locality invariant is violated.</p>
<p>See <a class="autorefs autorefs-internal" title="Tree


  
      dataclass
  " href="../trees/#delphyne.Tree"><code>Tree</code></a> and <code>check_local_value</code>.</p>








              <details class="quote">
                <summary>Source code in <code>src/delphyne/core/refs.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">LocalityError</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Exception raised when the locality invariant is violated.</span>

<span class="sd">    See `Tree` and `check_local_value`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">expected_node_ref</span><span class="p">:</span> <span class="n">GlobalNodePath</span>
    <span class="n">node_ref</span><span class="p">:</span> <span class="n">GlobalNodePath</span>
    <span class="n">local_ref</span><span class="p">:</span> <span class="n">AtomicValueRef</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div><h2 id="traces">Traces</h2>


<div class="doc doc-object doc-class">



<h3 id="delphyne.core.traces.Trace" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">Trace</span>


</h3>


    <div class="doc doc-contents first">


        <p>A collection of reachable nodes and spaces, which is encoded in a
concise way by introducing unique identifiers for answers and nodes.</p>
<p>Traces are mutable. Methods are provided to convert full references
into id-based references, creating fresh identifiers for new nodes
and queries on the fly. Backward conversion methods are also
provided for converting id-based references back into full
references (assuming id-based references are valid, without which
these methods fail with assertion errors).</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="delphyne.core.traces.Trace.nodes">nodes</span></code></td>
            <td>
                  <code><span title="dict">dict</span>[<a class="autorefs autorefs-internal" title="NodeId


  
      dataclass
   (delphyne.core.refs.NodeId)" href="#delphyne.core.refs.NodeId">NodeId</a>, <a class="autorefs autorefs-internal" title="NodeOrigin (delphyne.core.refs.NodeOrigin)" href="#delphyne.core.refs.NodeOrigin">NodeOrigin</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a mapping from node identifiers to their origin.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="delphyne.core.traces.Trace.node_ids">node_ids</span></code></td>
            <td>
                  <code><span title="dict">dict</span>[<a class="autorefs autorefs-internal" title="NodeOrigin (delphyne.core.refs.NodeOrigin)" href="#delphyne.core.refs.NodeOrigin">NodeOrigin</a>, <a class="autorefs autorefs-internal" title="NodeId


  
      dataclass
   (delphyne.core.refs.NodeId)" href="#delphyne.core.refs.NodeId">NodeId</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>reverse map of <code>nodes</code>.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="delphyne.core.traces.Trace.answers">answers</span></code></td>
            <td>
                  <code><span title="dict">dict</span>[<a class="autorefs autorefs-internal" title="AnswerId


  
      dataclass
   (delphyne.core.refs.AnswerId)" href="#delphyne.core.refs.AnswerId">AnswerId</a>, <span title="tuple">tuple</span>[<a class="autorefs autorefs-internal" title="QueryOrigin


  
      dataclass
   (delphyne.core.traces.QueryOrigin)" href="#delphyne.core.traces.QueryOrigin">QueryOrigin</a>, <a class="autorefs autorefs-internal" title="Answer


  
      dataclass
   (delphyne.core.refs.Answer)" href="#delphyne.Answer">Answer</a>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a mapping from answer identifiers to actual answers,
along with origin information on the associated query.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="delphyne.core.traces.Trace.answer_ids">answer_ids</span></code></td>
            <td>
                  <code><span title="dict">dict</span>[<a class="autorefs autorefs-internal" title="QueryOrigin


  
      dataclass
   (delphyne.core.traces.QueryOrigin)" href="#delphyne.core.traces.QueryOrigin">QueryOrigin</a>, <span title="dict">dict</span>[<a class="autorefs autorefs-internal" title="Answer


  
      dataclass
   (delphyne.core.refs.Answer)" href="#delphyne.Answer">Answer</a>, <a class="autorefs autorefs-internal" title="AnswerId


  
      dataclass
   (delphyne.core.refs.AnswerId)" href="#delphyne.core.refs.AnswerId">AnswerId</a>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>reverse map of <code>answers</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>src/delphyne/core/traces.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Trace</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A collection of reachable nodes and spaces, which is encoded in a</span>
<span class="sd">    concise way by introducing unique identifiers for answers and nodes.</span>

<span class="sd">    Traces are mutable. Methods are provided to convert full references</span>
<span class="sd">    into id-based references, creating fresh identifiers for new nodes</span>
<span class="sd">    and queries on the fly. Backward conversion methods are also</span>
<span class="sd">    provided for converting id-based references back into full</span>
<span class="sd">    references (assuming id-based references are valid, without which</span>
<span class="sd">    these methods fail with assertion errors).</span>

<span class="sd">    Attributes:</span>
<span class="sd">        nodes: a mapping from node identifiers to their origin.</span>
<span class="sd">        node_ids: reverse map of `nodes`.</span>
<span class="sd">        answers: a mapping from answer identifiers to actual answers,</span>
<span class="sd">            along with origin information on the associated query.</span>
<span class="sd">        answer_ids: reverse map of `answers`.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">GLOBAL_ORIGIN_ID</span> <span class="o">=</span> <span class="n">refs</span><span class="o">.</span><span class="n">NodeId</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create an empty trace.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">refs</span><span class="o">.</span><span class="n">NodeId</span><span class="p">,</span> <span class="n">refs</span><span class="o">.</span><span class="n">NodeOrigin</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_ids</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">refs</span><span class="o">.</span><span class="n">NodeOrigin</span><span class="p">,</span> <span class="n">refs</span><span class="o">.</span><span class="n">NodeId</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">answers</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">refs</span><span class="o">.</span><span class="n">AnswerId</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">QueryOrigin</span><span class="p">,</span> <span class="n">refs</span><span class="o">.</span><span class="n">Answer</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">answer_ids</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span>
            <span class="n">QueryOrigin</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="n">refs</span><span class="o">.</span><span class="n">Answer</span><span class="p">,</span> <span class="n">refs</span><span class="o">.</span><span class="n">AnswerId</span><span class="p">]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_node_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_answer_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fresh_or_cached_node_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">origin</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">NodeOrigin</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">refs</span><span class="o">.</span><span class="n">NodeId</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Obtain the identifier of a node described by its origin.</span>
<span class="sd">        Create a new identifier on the fly if it does not exist yet.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">origin</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_ids</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_ids</span><span class="p">[</span><span class="n">origin</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_last_node_id</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="n">refs</span><span class="o">.</span><span class="n">NodeId</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_last_node_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">origin</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">node_ids</span><span class="p">[</span><span class="n">origin</span><span class="p">]</span> <span class="o">=</span> <span class="nb">id</span>
            <span class="k">return</span> <span class="nb">id</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">fresh_or_cached_answer_id</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">answer</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">Answer</span><span class="p">,</span> <span class="n">origin</span><span class="p">:</span> <span class="n">QueryOrigin</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">refs</span><span class="o">.</span><span class="n">AnswerId</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Obtain the identifier of an answer, given its content and the</span>
<span class="sd">        origin of the query that it corresponds to. Create a new, fresh</span>
<span class="sd">        identifier on the fly if it does not exist yet.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">origin</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">answer_ids</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">answer_ids</span><span class="p">[</span><span class="n">origin</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">answer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">answer_ids</span><span class="p">[</span><span class="n">origin</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">answer_ids</span><span class="p">[</span><span class="n">origin</span><span class="p">][</span><span class="n">answer</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_last_answer_id</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="n">refs</span><span class="o">.</span><span class="n">AnswerId</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_last_answer_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">answers</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">origin</span><span class="p">,</span> <span class="n">answer</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">answer_ids</span><span class="p">[</span><span class="n">origin</span><span class="p">][</span><span class="n">answer</span><span class="p">]</span> <span class="o">=</span> <span class="nb">id</span>
            <span class="k">return</span> <span class="nb">id</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">register_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">origin</span><span class="p">:</span> <span class="n">QueryOrigin</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensure that a query appears in the trace, even if not answers</span>
<span class="sd">        are associated with it yet.</span>

<span class="sd">        This is particularly useful for the demonstration interpreter.</span>
<span class="sd">        Indeed, when a test gets stuck on an unanswered query, it is</span>
<span class="sd">        desirable for this query to be part of the returned trace so</span>
<span class="sd">        that the user can visualize it.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">origin</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">answer_ids</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">answer_ids</span><span class="p">[</span><span class="n">origin</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">export</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ExportableTrace</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Export a trace into a lightweight, serializable format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nb">id</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="n">pprint</span><span class="o">.</span><span class="n">node_origin</span><span class="p">(</span><span class="n">origin</span><span class="p">)</span>
            <span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">origin</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="n">queries</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ExportableQueryInfo</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">q</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">answer_ids</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="n">pprint</span><span class="o">.</span><span class="n">space_ref</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">ref</span><span class="p">)</span>
            <span class="n">answers</span> <span class="o">=</span> <span class="p">{</span><span class="nb">id</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="n">value</span> <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
            <span class="n">queries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ExportableQueryInfo</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">answers</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">ExportableTrace</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">queries</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_consistency</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform a sanity check on the trace.</span>

<span class="sd">        Each node identifier is expanded into a full reference and then</span>
<span class="sd">        converted back to an identifier, which must be equal to the</span>
<span class="sd">        original one.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
            <span class="n">expanded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_node_id</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
            <span class="k">assert</span> <span class="nb">id</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_global_node_path</span><span class="p">(</span><span class="n">expanded</span><span class="p">)</span>

    <span class="c1">### Convert full references into id-based references</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">convert_location</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">:</span> <span class="n">Location</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ShortLocation</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert a full location into an id-based one.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_global_node_path</span><span class="p">(</span><span class="n">location</span><span class="o">.</span><span class="n">node</span><span class="p">)</span>
        <span class="n">space</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">location</span><span class="o">.</span><span class="n">space</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">space</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_space_ref</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">location</span><span class="o">.</span><span class="n">space</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ShortLocation</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">space</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">convert_query_origin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">GlobalSpacePath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QueryOrigin</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert a full, global space reference denoting a quey origin</span>
<span class="sd">        into an id-based reference.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_global_node_path</span><span class="p">(</span><span class="n">ref</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">space</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_space_ref</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">ref</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">origin</span> <span class="o">=</span> <span class="n">QueryOrigin</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">space</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">register_query</span><span class="p">(</span><span class="n">origin</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">origin</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">convert_answer_ref</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">ref</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">refs</span><span class="o">.</span><span class="n">GlobalSpacePath</span><span class="p">,</span> <span class="n">refs</span><span class="o">.</span><span class="n">Answer</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">refs</span><span class="o">.</span><span class="n">AnswerId</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert a full answer reference into an answer id.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">node_path</span><span class="p">,</span> <span class="n">space</span> <span class="o">=</span> <span class="n">ref</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_global_node_path</span><span class="p">(</span><span class="n">node_path</span><span class="p">)</span>
        <span class="n">space</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_space_ref</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">space</span><span class="p">)</span>
        <span class="n">origin</span> <span class="o">=</span> <span class="n">QueryOrigin</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">space</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fresh_or_cached_answer_id</span><span class="p">(</span><span class="n">ref</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">origin</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">convert_global_node_path</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">GlobalNodePath</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">refs</span><span class="o">.</span><span class="n">NodeId</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert a full, global node reference into an id-based one.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">Trace</span><span class="o">.</span><span class="n">GLOBAL_ORIGIN_ID</span>
        <span class="k">for</span> <span class="n">space</span><span class="p">,</span> <span class="n">node_path</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
            <span class="n">space_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_space_ref</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">space</span><span class="p">)</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fresh_or_cached_node_id</span><span class="p">(</span><span class="n">refs</span><span class="o">.</span><span class="n">NestedTreeOf</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">space_ref</span><span class="p">))</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_node_path</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">node_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">id</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">convert_global_space_path</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">GlobalSpacePath</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">refs</span><span class="o">.</span><span class="n">SpaceRef</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert a full global space reference into an id-based one.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">node_path</span><span class="p">,</span> <span class="n">space_ref</span> <span class="o">=</span> <span class="n">path</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_global_node_path</span><span class="p">(</span><span class="n">node_path</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_space_ref</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">space_ref</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_convert_node_path</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">NodeId</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">NodePath</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">refs</span><span class="o">.</span><span class="n">NodeId</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert a full local node path into an identifier, relative to a</span>
<span class="sd">        given node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
            <span class="n">action_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_value_ref</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fresh_or_cached_node_id</span><span class="p">(</span><span class="n">refs</span><span class="o">.</span><span class="n">ChildOf</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">action_ref</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">id</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_convert_space_ref</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">NodeId</span><span class="p">,</span> <span class="n">ref</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">SpaceRef</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">refs</span><span class="o">.</span><span class="n">SpaceRef</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert a full local space reference into an id-based one, relative</span>
<span class="sd">        to a given node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">args</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_convert_value_ref</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ref</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">refs</span><span class="o">.</span><span class="n">SpaceRef</span><span class="p">(</span><span class="n">ref</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_convert_atomic_value_ref</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">NodeId</span><span class="p">,</span> <span class="n">ref</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">AtomicValueRef</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">refs</span><span class="o">.</span><span class="n">AtomicValueRef</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert a full local atomic value reference into an id-based one,</span>
<span class="sd">        relative to a given node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">refs</span><span class="o">.</span><span class="n">IndexedRef</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">refs</span><span class="o">.</span><span class="n">IndexedRef</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_convert_atomic_value_ref</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">ref</span><span class="o">.</span><span class="n">ref</span><span class="p">),</span> <span class="n">ref</span><span class="o">.</span><span class="n">index</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_space_element_ref</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_convert_value_ref</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">NodeId</span><span class="p">,</span> <span class="n">ref</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">ValueRef</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">refs</span><span class="o">.</span><span class="n">ValueRef</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert a full local value reference into an id-based one,</span>
<span class="sd">        relative to a given node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ref</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_convert_value_ref</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ref</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_atomic_value_ref</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_convert_space_element_ref</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">NodeId</span><span class="p">,</span> <span class="n">ref</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">SpaceElementRef</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">refs</span><span class="o">.</span><span class="n">SpaceElementRef</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert a full local space element reference into an id-based one,</span>
<span class="sd">        relative to a given node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">space</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">ref</span><span class="o">.</span><span class="n">space</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">space</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_space_ref</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">ref</span><span class="o">.</span><span class="n">space</span><span class="p">)</span>
        <span class="k">match</span> <span class="n">ref</span><span class="o">.</span><span class="n">element</span><span class="p">:</span>
            <span class="k">case</span> <span class="n">refs</span><span class="o">.</span><span class="n">Answer</span><span class="p">():</span>
                <span class="k">assert</span> <span class="n">space</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="n">origin</span> <span class="o">=</span> <span class="n">QueryOrigin</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">space</span><span class="p">)</span>
                <span class="n">element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fresh_or_cached_answer_id</span><span class="p">(</span><span class="n">ref</span><span class="o">.</span><span class="n">element</span><span class="p">,</span> <span class="n">origin</span><span class="p">)</span>
            <span class="k">case</span> <span class="n">refs</span><span class="o">.</span><span class="n">AnswerId</span><span class="p">()</span> <span class="o">|</span> <span class="n">refs</span><span class="o">.</span><span class="n">NodeId</span><span class="p">():</span>
                <span class="n">element</span> <span class="o">=</span> <span class="n">ref</span><span class="o">.</span><span class="n">element</span>
            <span class="k">case</span> <span class="n">refs</span><span class="o">.</span><span class="n">HintsRef</span><span class="p">():</span>
                <span class="k">assert</span> <span class="kc">False</span>
            <span class="k">case</span> <span class="nb">tuple</span><span class="p">():</span>
                <span class="k">assert</span> <span class="n">space</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="n">nested_root_orig</span> <span class="o">=</span> <span class="n">refs</span><span class="o">.</span><span class="n">NestedTreeOf</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">space</span><span class="p">)</span>
                <span class="n">nested_root</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fresh_or_cached_node_id</span><span class="p">(</span><span class="n">nested_root_orig</span><span class="p">)</span>
                <span class="n">element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_node_path</span><span class="p">(</span><span class="n">nested_root</span><span class="p">,</span> <span class="n">ref</span><span class="o">.</span><span class="n">element</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">refs</span><span class="o">.</span><span class="n">SpaceElementRef</span><span class="p">(</span><span class="n">space</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span>

    <span class="c1">### Reverse direction: expanding id-based references into full ones.</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">expand_space_ref</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">NodeId</span><span class="p">,</span> <span class="n">ref</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">SpaceRef</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">refs</span><span class="o">.</span><span class="n">SpaceRef</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert a local id-based space reference into a full one,</span>
<span class="sd">        relative to a given node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">args</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expand_value_ref</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ref</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">refs</span><span class="o">.</span><span class="n">SpaceRef</span><span class="p">(</span><span class="n">ref</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">expand_value_ref</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">NodeId</span><span class="p">,</span> <span class="n">ref</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">ValueRef</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">refs</span><span class="o">.</span><span class="n">ValueRef</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert a local id-based value reference into a full one,</span>
<span class="sd">        relative to a given node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ref</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expand_value_ref</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ref</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expand_atomic_value_ref</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">expand_node_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">NodeId</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">refs</span><span class="o">.</span><span class="n">GlobalNodePath</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert a node identifier into a full, global node reference.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rev_path</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">refs</span><span class="o">.</span><span class="n">SpaceRef</span><span class="p">,</span> <span class="n">refs</span><span class="o">.</span><span class="n">NodePath</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="nb">id</span> <span class="o">!=</span> <span class="n">Trace</span><span class="o">.</span><span class="n">GLOBAL_ORIGIN_ID</span><span class="p">:</span>
            <span class="nb">id</span><span class="p">,</span> <span class="n">space</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recover_path</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
            <span class="n">rev_path</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">space</span><span class="p">,</span> <span class="n">path</span><span class="p">))</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">rev_path</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_expand_atomic_value_ref</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">NodeId</span><span class="p">,</span> <span class="n">ref</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">AtomicValueRef</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">refs</span><span class="o">.</span><span class="n">AtomicValueRef</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert a local id-based atomic value reference into a full one,</span>
<span class="sd">        relative to a given node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">refs</span><span class="o">.</span><span class="n">IndexedRef</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">refs</span><span class="o">.</span><span class="n">IndexedRef</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_expand_atomic_value_ref</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">ref</span><span class="o">.</span><span class="n">ref</span><span class="p">),</span> <span class="n">ref</span><span class="o">.</span><span class="n">index</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expand_space_element_ref</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_expand_space_element_ref</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">NodeId</span><span class="p">,</span> <span class="n">ref</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">SpaceElementRef</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">refs</span><span class="o">.</span><span class="n">SpaceElementRef</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert a local id-based space element reference into a full</span>
<span class="sd">        one, relative to a given node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="n">refs</span><span class="o">.</span><span class="n">SpaceElementRef</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">ref</span><span class="o">.</span><span class="n">space</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">space</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_space_ref</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">ref</span><span class="o">.</span><span class="n">space</span><span class="p">)</span>
        <span class="k">match</span> <span class="n">ref</span><span class="o">.</span><span class="n">element</span><span class="p">:</span>
            <span class="k">case</span> <span class="n">refs</span><span class="o">.</span><span class="n">AnswerId</span><span class="p">():</span>
                <span class="n">_orig</span><span class="p">,</span> <span class="n">ans</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">answers</span><span class="p">[</span><span class="n">ref</span><span class="o">.</span><span class="n">element</span><span class="p">]</span>
                <span class="n">element</span> <span class="o">=</span> <span class="n">ans</span>
            <span class="k">case</span> <span class="n">refs</span><span class="o">.</span><span class="n">NodeId</span><span class="p">():</span>
                <span class="n">orig</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">element</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recover_path</span><span class="p">(</span><span class="n">ref</span><span class="o">.</span><span class="n">element</span><span class="p">)</span>
                <span class="k">assert</span> <span class="n">orig</span> <span class="o">==</span> <span class="nb">id</span>
            <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
                <span class="k">assert</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="n">refs</span><span class="o">.</span><span class="n">SpaceElementRef</span><span class="p">(</span><span class="n">space</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_recover_path</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">dst</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">NodeId</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">refs</span><span class="o">.</span><span class="n">NodeId</span><span class="p">,</span> <span class="n">refs</span><span class="o">.</span><span class="n">SpaceRef</span><span class="p">,</span> <span class="n">refs</span><span class="o">.</span><span class="n">NodePath</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find the node from which the tree containing `dst` originates.</span>

<span class="sd">        Return the node in which the full surrounding tree is nested,</span>
<span class="sd">        the associated space reference, and a path to `dst` from the</span>
<span class="sd">        root of the surrounding tree.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">rev_path</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">refs</span><span class="o">.</span><span class="n">ValueRef</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">dst_origin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="n">dst</span><span class="p">]</span>
            <span class="k">match</span> <span class="n">dst_origin</span><span class="p">:</span>
                <span class="k">case</span> <span class="n">refs</span><span class="o">.</span><span class="n">ChildOf</span><span class="p">(</span><span class="n">before</span><span class="p">,</span> <span class="n">action</span><span class="p">):</span>
                    <span class="n">rev_path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expand_value_ref</span><span class="p">(</span><span class="n">before</span><span class="p">,</span> <span class="n">action</span><span class="p">))</span>
                    <span class="n">dst</span> <span class="o">=</span> <span class="n">before</span>
                <span class="k">case</span> <span class="n">refs</span><span class="o">.</span><span class="n">NestedTreeOf</span><span class="p">(</span><span class="n">orig</span><span class="p">,</span> <span class="n">space</span><span class="p">):</span>
                    <span class="n">space</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_space_ref</span><span class="p">(</span><span class="n">orig</span><span class="p">,</span> <span class="n">space</span><span class="p">)</span>
                    <span class="k">return</span> <span class="n">orig</span><span class="p">,</span> <span class="n">space</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">rev_path</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="delphyne.core.traces.Trace.__init__" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">__init__</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">__init__</span><span class="p">()</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Create an empty trace.</p>


            <details class="quote">
              <summary>Source code in <code>src/delphyne/core/traces.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create an empty trace.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">refs</span><span class="o">.</span><span class="n">NodeId</span><span class="p">,</span> <span class="n">refs</span><span class="o">.</span><span class="n">NodeOrigin</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">node_ids</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">refs</span><span class="o">.</span><span class="n">NodeOrigin</span><span class="p">,</span> <span class="n">refs</span><span class="o">.</span><span class="n">NodeId</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">answers</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="n">refs</span><span class="o">.</span><span class="n">AnswerId</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">QueryOrigin</span><span class="p">,</span> <span class="n">refs</span><span class="o">.</span><span class="n">Answer</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">answer_ids</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span>
        <span class="n">QueryOrigin</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="n">refs</span><span class="o">.</span><span class="n">Answer</span><span class="p">,</span> <span class="n">refs</span><span class="o">.</span><span class="n">AnswerId</span><span class="p">]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_last_node_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_last_answer_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="delphyne.core.traces.Trace.fresh_or_cached_node_id" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">fresh_or_cached_node_id</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">fresh_or_cached_node_id</span><span class="p">(</span><span class="n">origin</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="NodeOrigin (delphyne.core.refs.NodeOrigin)" href="#delphyne.core.refs.NodeOrigin">NodeOrigin</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="NodeId


  
      dataclass
   (delphyne.core.refs.NodeId)" href="#delphyne.core.refs.NodeId">NodeId</a></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Obtain the identifier of a node described by its origin.
Create a new identifier on the fly if it does not exist yet.</p>


            <details class="quote">
              <summary>Source code in <code>src/delphyne/core/traces.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fresh_or_cached_node_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">origin</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">NodeOrigin</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">refs</span><span class="o">.</span><span class="n">NodeId</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Obtain the identifier of a node described by its origin.</span>
<span class="sd">    Create a new identifier on the fly if it does not exist yet.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">origin</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_ids</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">node_ids</span><span class="p">[</span><span class="n">origin</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_node_id</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">refs</span><span class="o">.</span><span class="n">NodeId</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_last_node_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="n">origin</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node_ids</span><span class="p">[</span><span class="n">origin</span><span class="p">]</span> <span class="o">=</span> <span class="nb">id</span>
        <span class="k">return</span> <span class="nb">id</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="delphyne.core.traces.Trace.fresh_or_cached_answer_id" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">fresh_or_cached_answer_id</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">fresh_or_cached_answer_id</span><span class="p">(</span><span class="n">answer</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="Answer


  
      dataclass
   (delphyne.core.refs.Answer)" href="#delphyne.Answer">Answer</a></span><span class="p">,</span> <span class="n">origin</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="QueryOrigin


  
      dataclass
   (delphyne.core.traces.QueryOrigin)" href="#delphyne.core.traces.QueryOrigin">QueryOrigin</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="AnswerId


  
      dataclass
   (delphyne.core.refs.AnswerId)" href="#delphyne.core.refs.AnswerId">AnswerId</a></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Obtain the identifier of an answer, given its content and the
origin of the query that it corresponds to. Create a new, fresh
identifier on the fly if it does not exist yet.</p>


            <details class="quote">
              <summary>Source code in <code>src/delphyne/core/traces.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fresh_or_cached_answer_id</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">answer</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">Answer</span><span class="p">,</span> <span class="n">origin</span><span class="p">:</span> <span class="n">QueryOrigin</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">refs</span><span class="o">.</span><span class="n">AnswerId</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Obtain the identifier of an answer, given its content and the</span>
<span class="sd">    origin of the query that it corresponds to. Create a new, fresh</span>
<span class="sd">    identifier on the fly if it does not exist yet.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">origin</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">answer_ids</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">answer_ids</span><span class="p">[</span><span class="n">origin</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">answer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">answer_ids</span><span class="p">[</span><span class="n">origin</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">answer_ids</span><span class="p">[</span><span class="n">origin</span><span class="p">][</span><span class="n">answer</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_answer_id</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">refs</span><span class="o">.</span><span class="n">AnswerId</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_last_answer_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">answers</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">origin</span><span class="p">,</span> <span class="n">answer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">answer_ids</span><span class="p">[</span><span class="n">origin</span><span class="p">][</span><span class="n">answer</span><span class="p">]</span> <span class="o">=</span> <span class="nb">id</span>
        <span class="k">return</span> <span class="nb">id</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="delphyne.core.traces.Trace.register_query" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">register_query</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">register_query</span><span class="p">(</span><span class="n">origin</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="QueryOrigin


  
      dataclass
   (delphyne.core.traces.QueryOrigin)" href="#delphyne.core.traces.QueryOrigin">QueryOrigin</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Ensure that a query appears in the trace, even if not answers
are associated with it yet.</p>
<p>This is particularly useful for the demonstration interpreter.
Indeed, when a test gets stuck on an unanswered query, it is
desirable for this query to be part of the returned trace so
that the user can visualize it.</p>


            <details class="quote">
              <summary>Source code in <code>src/delphyne/core/traces.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">register_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">origin</span><span class="p">:</span> <span class="n">QueryOrigin</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ensure that a query appears in the trace, even if not answers</span>
<span class="sd">    are associated with it yet.</span>

<span class="sd">    This is particularly useful for the demonstration interpreter.</span>
<span class="sd">    Indeed, when a test gets stuck on an unanswered query, it is</span>
<span class="sd">    desirable for this query to be part of the returned trace so</span>
<span class="sd">    that the user can visualize it.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">origin</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">answer_ids</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">answer_ids</span><span class="p">[</span><span class="n">origin</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="delphyne.core.traces.Trace.export" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">export</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">export</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="ExportableTrace


  
      dataclass
   (delphyne.core.traces.ExportableTrace)" href="#delphyne.core.traces.ExportableTrace">ExportableTrace</a></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Export a trace into a lightweight, serializable format.</p>


            <details class="quote">
              <summary>Source code in <code>src/delphyne/core/traces.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">export</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ExportableTrace</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Export a trace into a lightweight, serializable format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nb">id</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="n">pprint</span><span class="o">.</span><span class="n">node_origin</span><span class="p">(</span><span class="n">origin</span><span class="p">)</span>
        <span class="k">for</span> <span class="nb">id</span><span class="p">,</span> <span class="n">origin</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="n">queries</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ExportableQueryInfo</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">q</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">answer_ids</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">ref</span> <span class="o">=</span> <span class="n">pprint</span><span class="o">.</span><span class="n">space_ref</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">ref</span><span class="p">)</span>
        <span class="n">answers</span> <span class="o">=</span> <span class="p">{</span><span class="nb">id</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="n">value</span> <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">a</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="n">queries</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ExportableQueryInfo</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">ref</span><span class="p">,</span> <span class="n">answers</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">ExportableTrace</span><span class="p">(</span><span class="n">nodes</span><span class="p">,</span> <span class="n">queries</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="delphyne.core.traces.Trace.check_consistency" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">check_consistency</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">check_consistency</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Perform a sanity check on the trace.</p>
<p>Each node identifier is expanded into a full reference and then
converted back to an identifier, which must be equal to the
original one.</p>


            <details class="quote">
              <summary>Source code in <code>src/delphyne/core/traces.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">check_consistency</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform a sanity check on the trace.</span>

<span class="sd">    Each node identifier is expanded into a full reference and then</span>
<span class="sd">    converted back to an identifier, which must be equal to the</span>
<span class="sd">    original one.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">nodes</span><span class="p">:</span>
        <span class="n">expanded</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_node_id</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">id</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_global_node_path</span><span class="p">(</span><span class="n">expanded</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="delphyne.core.traces.Trace.convert_location" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">convert_location</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">convert_location</span><span class="p">(</span><span class="n">location</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="Location


  
      dataclass
   (delphyne.core.traces.Location)" href="#delphyne.core.traces.Location">Location</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="ShortLocation


  
      dataclass
   (delphyne.core.traces.ShortLocation)" href="#delphyne.core.traces.ShortLocation">ShortLocation</a></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Convert a full location into an id-based one.</p>


            <details class="quote">
              <summary>Source code in <code>src/delphyne/core/traces.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">convert_location</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">:</span> <span class="n">Location</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ShortLocation</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a full location into an id-based one.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_global_node_path</span><span class="p">(</span><span class="n">location</span><span class="o">.</span><span class="n">node</span><span class="p">)</span>
    <span class="n">space</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">location</span><span class="o">.</span><span class="n">space</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">space</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_space_ref</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">location</span><span class="o">.</span><span class="n">space</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ShortLocation</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">space</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="delphyne.core.traces.Trace.convert_query_origin" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">convert_query_origin</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">convert_query_origin</span><span class="p">(</span><span class="n">ref</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="GlobalSpacePath (delphyne.core.refs.GlobalSpacePath)" href="#delphyne.core.refs.GlobalSpacePath">GlobalSpacePath</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="QueryOrigin


  
      dataclass
   (delphyne.core.traces.QueryOrigin)" href="#delphyne.core.traces.QueryOrigin">QueryOrigin</a></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Convert a full, global space reference denoting a quey origin
into an id-based reference.</p>


            <details class="quote">
              <summary>Source code in <code>src/delphyne/core/traces.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">convert_query_origin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">GlobalSpacePath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">QueryOrigin</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a full, global space reference denoting a quey origin</span>
<span class="sd">    into an id-based reference.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_global_node_path</span><span class="p">(</span><span class="n">ref</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">space</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_space_ref</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">ref</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">origin</span> <span class="o">=</span> <span class="n">QueryOrigin</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">space</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">register_query</span><span class="p">(</span><span class="n">origin</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">origin</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="delphyne.core.traces.Trace.convert_answer_ref" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">convert_answer_ref</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">convert_answer_ref</span><span class="p">(</span><span class="n">ref</span><span class="p">:</span> <span class="n"><span title="tuple">tuple</span></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="GlobalSpacePath (delphyne.core.refs.GlobalSpacePath)" href="#delphyne.core.refs.GlobalSpacePath">GlobalSpacePath</a></span><span class="p">,</span> <span class="n"><a class="autorefs autorefs-internal" title="Answer


  
      dataclass
   (delphyne.core.refs.Answer)" href="#delphyne.Answer">Answer</a></span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="AnswerId


  
      dataclass
   (delphyne.core.refs.AnswerId)" href="#delphyne.core.refs.AnswerId">AnswerId</a></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Convert a full answer reference into an answer id.</p>


            <details class="quote">
              <summary>Source code in <code>src/delphyne/core/traces.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">convert_answer_ref</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">ref</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">refs</span><span class="o">.</span><span class="n">GlobalSpacePath</span><span class="p">,</span> <span class="n">refs</span><span class="o">.</span><span class="n">Answer</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">refs</span><span class="o">.</span><span class="n">AnswerId</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a full answer reference into an answer id.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">node_path</span><span class="p">,</span> <span class="n">space</span> <span class="o">=</span> <span class="n">ref</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_global_node_path</span><span class="p">(</span><span class="n">node_path</span><span class="p">)</span>
    <span class="n">space</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_space_ref</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">space</span><span class="p">)</span>
    <span class="n">origin</span> <span class="o">=</span> <span class="n">QueryOrigin</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">space</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fresh_or_cached_answer_id</span><span class="p">(</span><span class="n">ref</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">origin</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="delphyne.core.traces.Trace.convert_global_node_path" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">convert_global_node_path</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">convert_global_node_path</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="GlobalNodePath (delphyne.core.refs.GlobalNodePath)" href="#delphyne.core.refs.GlobalNodePath">GlobalNodePath</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="NodeId


  
      dataclass
   (delphyne.core.refs.NodeId)" href="#delphyne.core.refs.NodeId">NodeId</a></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Convert a full, global node reference into an id-based one.</p>


            <details class="quote">
              <summary>Source code in <code>src/delphyne/core/traces.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">convert_global_node_path</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">GlobalNodePath</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">refs</span><span class="o">.</span><span class="n">NodeId</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a full, global node reference into an id-based one.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">Trace</span><span class="o">.</span><span class="n">GLOBAL_ORIGIN_ID</span>
    <span class="k">for</span> <span class="n">space</span><span class="p">,</span> <span class="n">node_path</span> <span class="ow">in</span> <span class="n">path</span><span class="p">:</span>
        <span class="n">space_ref</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_space_ref</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">space</span><span class="p">)</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fresh_or_cached_node_id</span><span class="p">(</span><span class="n">refs</span><span class="o">.</span><span class="n">NestedTreeOf</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">space_ref</span><span class="p">))</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_node_path</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">node_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">id</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="delphyne.core.traces.Trace.convert_global_space_path" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">convert_global_space_path</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">convert_global_space_path</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="GlobalSpacePath (delphyne.core.refs.GlobalSpacePath)" href="#delphyne.core.refs.GlobalSpacePath">GlobalSpacePath</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="SpaceRef


  
      dataclass
   (delphyne.core.refs.SpaceRef)" href="#delphyne.core.refs.SpaceRef">SpaceRef</a></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Convert a full global space reference into an id-based one.</p>


            <details class="quote">
              <summary>Source code in <code>src/delphyne/core/traces.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">convert_global_space_path</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">GlobalSpacePath</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">refs</span><span class="o">.</span><span class="n">SpaceRef</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a full global space reference into an id-based one.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">node_path</span><span class="p">,</span> <span class="n">space_ref</span> <span class="o">=</span> <span class="n">path</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_global_node_path</span><span class="p">(</span><span class="n">node_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_convert_space_ref</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">space_ref</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="delphyne.core.traces.Trace.expand_space_ref" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">expand_space_ref</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">expand_space_ref</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="NodeId


  
      dataclass
   (delphyne.core.refs.NodeId)" href="#delphyne.core.refs.NodeId">NodeId</a></span><span class="p">,</span> <span class="n">ref</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="SpaceRef


  
      dataclass
   (delphyne.core.refs.SpaceRef)" href="#delphyne.core.refs.SpaceRef">SpaceRef</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="SpaceRef


  
      dataclass
   (delphyne.core.refs.SpaceRef)" href="#delphyne.core.refs.SpaceRef">SpaceRef</a></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Convert a local id-based space reference into a full one,
relative to a given node.</p>


            <details class="quote">
              <summary>Source code in <code>src/delphyne/core/traces.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">expand_space_ref</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">NodeId</span><span class="p">,</span> <span class="n">ref</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">SpaceRef</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">refs</span><span class="o">.</span><span class="n">SpaceRef</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a local id-based space reference into a full one,</span>
<span class="sd">    relative to a given node.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">args</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expand_value_ref</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ref</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">refs</span><span class="o">.</span><span class="n">SpaceRef</span><span class="p">(</span><span class="n">ref</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="delphyne.core.traces.Trace.expand_value_ref" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">expand_value_ref</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">expand_value_ref</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="NodeId


  
      dataclass
   (delphyne.core.refs.NodeId)" href="#delphyne.core.refs.NodeId">NodeId</a></span><span class="p">,</span> <span class="n">ref</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="ValueRef (delphyne.core.refs.ValueRef)" href="#delphyne.core.refs.ValueRef">ValueRef</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="ValueRef (delphyne.core.refs.ValueRef)" href="#delphyne.core.refs.ValueRef">ValueRef</a></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Convert a local id-based value reference into a full one,
relative to a given node.</p>


            <details class="quote">
              <summary>Source code in <code>src/delphyne/core/traces.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">expand_value_ref</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">NodeId</span><span class="p">,</span> <span class="n">ref</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">ValueRef</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">refs</span><span class="o">.</span><span class="n">ValueRef</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a local id-based value reference into a full one,</span>
<span class="sd">    relative to a given node.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">ref</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ref</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expand_value_ref</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ref</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_expand_atomic_value_ref</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="delphyne.core.traces.Trace.expand_node_id" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">expand_node_id</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">expand_node_id</span><span class="p">(</span><span class="nb">id</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="NodeId


  
      dataclass
   (delphyne.core.refs.NodeId)" href="#delphyne.core.refs.NodeId">NodeId</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="GlobalNodePath (delphyne.core.refs.GlobalNodePath)" href="#delphyne.core.refs.GlobalNodePath">GlobalNodePath</a></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Convert a node identifier into a full, global node reference.</p>


            <details class="quote">
              <summary>Source code in <code>src/delphyne/core/traces.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">expand_node_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">id</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">NodeId</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">refs</span><span class="o">.</span><span class="n">GlobalNodePath</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convert a node identifier into a full, global node reference.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rev_path</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">refs</span><span class="o">.</span><span class="n">SpaceRef</span><span class="p">,</span> <span class="n">refs</span><span class="o">.</span><span class="n">NodePath</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">while</span> <span class="nb">id</span> <span class="o">!=</span> <span class="n">Trace</span><span class="o">.</span><span class="n">GLOBAL_ORIGIN_ID</span><span class="p">:</span>
        <span class="nb">id</span><span class="p">,</span> <span class="n">space</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_recover_path</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span>
        <span class="n">rev_path</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">space</span><span class="p">,</span> <span class="n">path</span><span class="p">))</span>
    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">reversed</span><span class="p">(</span><span class="n">rev_path</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="delphyne.core.traces.QueryOrigin" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">QueryOrigin</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


    <div class="doc doc-contents first">


        <p>A global, id-based reference to the space induced by a query.</p>








              <details class="quote">
                <summary>Source code in <code>src/delphyne/core/traces.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">QueryOrigin</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A global, id-based reference to the space induced by a query.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">node</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">NodeId</span>
    <span class="n">ref</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">SpaceRef</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="delphyne.core.traces.ExportableTrace" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">ExportableTrace</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


    <div class="doc doc-contents first">


        <p>A lightweight trace format that can be easily exported to JSON/YAML.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="delphyne.core.traces.ExportableTrace.nodes">nodes</span></code></td>
            <td>
                  <code><span title="dict">dict</span>[<span title="int">int</span>, <a class="autorefs autorefs-internal" title="NodeOriginStr (delphyne.core.traces.NodeOriginStr)" href="#delphyne.core.traces.NodeOriginStr">NodeOriginStr</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a mapping from node ids to serialized origin information.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="delphyne.core.traces.ExportableTrace.queries">queries</span></code></td>
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="ExportableQueryInfo


  
      dataclass
   (delphyne.core.traces.ExportableQueryInfo)" href="#delphyne.core.traces.ExportableQueryInfo">ExportableQueryInfo</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a list of encountered queries with associated answers.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>src/delphyne/core/traces.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ExportableTrace</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A lightweight trace format that can be easily exported to JSON/YAML.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        nodes: a mapping from node ids to serialized origin information.</span>
<span class="sd">        queries: a list of encountered queries with associated answers.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">nodes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">NodeOriginStr</span><span class="p">]</span>
    <span class="n">queries</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ExportableQueryInfo</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="delphyne.core.traces.ExportableQueryInfo" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">ExportableQueryInfo</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


    <div class="doc doc-contents first">


        <p>Information about a query encountered in an exportable trace.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="delphyne.core.traces.ExportableQueryInfo.node">node</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Identifier of the node that the query is attached to.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="delphyne.core.traces.ExportableQueryInfo.space">space</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Local, id-based reference of the space that the query
belongs to. Serialized using <code>pprint.space_ref</code>.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="delphyne.core.traces.ExportableQueryInfo.answers">answers</span></code></td>
            <td>
                  <code><span title="dict">dict</span>[<span title="int">int</span>, <a class="autorefs autorefs-internal" title="Answer


  
      dataclass
   (delphyne.core.refs.Answer)" href="#delphyne.Answer">Answer</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Mapping from answer identifiers to actual answers.
Answer identifiers are unique across a whole exportable
trace (and not only across an <code>ExportableQueryInfo</code> value).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>src/delphyne/core/traces.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ExportableQueryInfo</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Information about a query encountered in an exportable trace.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        node: Identifier of the node that the query is attached to.</span>
<span class="sd">        space: Local, id-based reference of the space that the query</span>
<span class="sd">            belongs to. Serialized using `pprint.space_ref`.</span>
<span class="sd">        answers: Mapping from answer identifiers to actual answers.</span>
<span class="sd">            Answer identifiers are unique across a whole exportable</span>
<span class="sd">            trace (and not only across an `ExportableQueryInfo` value).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">node</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">space</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">answers</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">refs</span><span class="o">.</span><span class="n">Answer</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-type_alias">



<h3 id="delphyne.core.traces.NodeOriginStr" class="doc doc-heading">
            <span class="doc doc-object-name doc-type_alias-name">NodeOriginStr</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nc">NodeOriginStr</span> <span class="o">=</span> <span class="n"><span title="str">str</span></span>
</code></pre></div>

    <div class="doc doc-contents first">

        <p>A concise, serialized representation for <code>NodeOrigin</code>.</p>
    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="delphyne.core.traces.Location" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">Location</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


    <div class="doc doc-contents first">


        <p>A <strong>full</strong>, global reference to either a node or a space.</p>
<p>This is useful in particular for attaching location information to
logging messages.</p>








              <details class="quote">
                <summary>Source code in <code>src/delphyne/core/traces.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">Location</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A **full**, global reference to either a node or a space.</span>

<span class="sd">    This is useful in particular for attaching location information to</span>
<span class="sd">    logging messages.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">node</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">GlobalNodePath</span>
    <span class="n">space</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">SpaceRef</span> <span class="o">|</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="delphyne.core.traces.ShortLocation" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">ShortLocation</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


    <div class="doc doc-contents first">


        <p>An <strong>id-based</strong>, global reference to either a node or a space.</p>
<p>This is the id-based counterpart of <a class="autorefs autorefs-internal" title="Location


  
      dataclass
  " href="#delphyne.core.traces.Location"><code>Location</code></a>. Policies typically
log messages with <a class="autorefs autorefs-internal" title="Location


  
      dataclass
  " href="#delphyne.core.traces.Location"><code>Location</code></a> values attached (since trees feature
full references), which are then converted into <code>ShortLocation</code> in
the final exportable log.</p>








              <details class="quote">
                <summary>Source code in <code>src/delphyne/core/traces.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ShortLocation</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An **id-based**, global reference to either a node or a space.</span>

<span class="sd">    This is the id-based counterpart of `Location`. Policies typically</span>
<span class="sd">    log messages with `Location` values attached (since trees feature</span>
<span class="sd">    full references), which are then converted into `ShortLocation` in</span>
<span class="sd">    the final exportable log.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">node</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">NodeId</span>
    <span class="n">space</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">SpaceRef</span> <span class="o">|</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div><h2 id="tracers">Tracers</h2>


<div class="doc doc-object doc-class">



<h3 id="delphyne.Tracer" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">Tracer</span>


</h3>


    <div class="doc doc-contents first">


        <p>A mutable trace along with a mutable list of log messages.</p>
<p>Both components are protected by a lock to ensure thread-safety
(some policies spawn multiple concurrent threads).</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="delphyne.Tracer.trace">trace</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A mutable trace.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="delphyne.Tracer.messages">messages</span></code></td>
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="LogMessage


  
      dataclass
   (delphyne.core.traces.LogMessage)" href="#delphyne.LogMessage">LogMessage</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A mutable list of log messages.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="delphyne.Tracer.lock">lock</span></code></td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A reentrant lock protecting access to the trace and log.
The lock is publicly exposed so that threads can log several
successive messages without other threads interleaving new
messages in between (TODO: there are cleaner ways to achieve
this).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>src/delphyne/core/traces.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Tracer</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A mutable trace along with a mutable list of log messages.</span>

<span class="sd">    Both components are protected by a lock to ensure thread-safety</span>
<span class="sd">    (some policies spawn multiple concurrent threads).</span>

<span class="sd">    Attributes:</span>
<span class="sd">        trace: A mutable trace.</span>
<span class="sd">        messages: A mutable list of log messages.</span>
<span class="sd">        lock: A reentrant lock protecting access to the trace and log.</span>
<span class="sd">            The lock is publicly exposed so that threads can log several</span>
<span class="sd">            successive messages without other threads interleaving new</span>
<span class="sd">            messages in between (TODO: there are cleaner ways to achieve</span>
<span class="sd">            this).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span> <span class="o">=</span> <span class="n">Trace</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">LogMessage</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Different threads may be logging information or appending to</span>
        <span class="c1"># the trace in parallel.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">RLock</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">trace_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">GlobalNodePath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensure that a node at a given reference is present in the trace.</span>

<span class="sd">        See `tracer_hook` for registering a hook that automatically</span>
<span class="sd">        calls this method on all encountered nodes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="o">.</span><span class="n">convert_location</span><span class="p">(</span><span class="n">Location</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">trace_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">GlobalSpacePath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensure that a query at a given reference is present in the</span>
<span class="sd">        trace, even if no answer is provided for it.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="o">.</span><span class="n">convert_query_origin</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">trace_answer</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">space</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">GlobalSpacePath</span><span class="p">,</span> <span class="n">answer</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">Answer</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ensure that a given query answer is present in the trace, even</span>
<span class="sd">        it is is not used to reach a node.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="o">.</span><span class="n">convert_answer_ref</span><span class="p">((</span><span class="n">space</span><span class="p">,</span> <span class="n">answer</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">metadata</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">location</span><span class="p">:</span> <span class="n">Location</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Log a message, with optional metadata and location information.</span>
<span class="sd">        The metadata must be a dictionary of JSON values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="n">short_location</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">location</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">short_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="o">.</span><span class="n">convert_location</span><span class="p">(</span><span class="n">location</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">LogMessage</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">short_location</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">export_log</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">ExportableLogMessage</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Export the log into an easily serializable format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="p">:</span>
                <span class="n">node</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">space</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">loc</span> <span class="o">:=</span> <span class="n">m</span><span class="o">.</span><span class="n">location</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">node</span> <span class="o">=</span> <span class="n">loc</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">id</span>
                    <span class="k">if</span> <span class="n">loc</span><span class="o">.</span><span class="n">space</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">space</span> <span class="o">=</span> <span class="n">pprint</span><span class="o">.</span><span class="n">space_ref</span><span class="p">(</span><span class="n">loc</span><span class="o">.</span><span class="n">space</span><span class="p">)</span>
                <span class="k">yield</span> <span class="n">ExportableLogMessage</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">message</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">space</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">export_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ExportableTrace</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Export the trace into an easily serializable format.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="o">.</span><span class="n">export</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="delphyne.Tracer.trace_node" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">trace_node</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">trace_node</span><span class="p">(</span><span class="n">node</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="GlobalNodePath (delphyne.core.refs.GlobalNodePath)" href="#delphyne.core.refs.GlobalNodePath">GlobalNodePath</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Ensure that a node at a given reference is present in the trace.</p>
<p>See <a class="autorefs autorefs-internal" title="tracer_hook" href="#delphyne.tracer_hook"><code>tracer_hook</code></a> for registering a hook that automatically
calls this method on all encountered nodes.</p>


            <details class="quote">
              <summary>Source code in <code>src/delphyne/core/traces.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">trace_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">GlobalNodePath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ensure that a node at a given reference is present in the trace.</span>

<span class="sd">    See `tracer_hook` for registering a hook that automatically</span>
<span class="sd">    calls this method on all encountered nodes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="o">.</span><span class="n">convert_location</span><span class="p">(</span><span class="n">Location</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="delphyne.Tracer.trace_query" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">trace_query</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">trace_query</span><span class="p">(</span><span class="n">ref</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="GlobalSpacePath (delphyne.core.refs.GlobalSpacePath)" href="#delphyne.core.refs.GlobalSpacePath">GlobalSpacePath</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Ensure that a query at a given reference is present in the
trace, even if no answer is provided for it.</p>


            <details class="quote">
              <summary>Source code in <code>src/delphyne/core/traces.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">trace_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ref</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">GlobalSpacePath</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ensure that a query at a given reference is present in the</span>
<span class="sd">    trace, even if no answer is provided for it.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="o">.</span><span class="n">convert_query_origin</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="delphyne.Tracer.trace_answer" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">trace_answer</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">trace_answer</span><span class="p">(</span><span class="n">space</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="GlobalSpacePath (delphyne.core.refs.GlobalSpacePath)" href="#delphyne.core.refs.GlobalSpacePath">GlobalSpacePath</a></span><span class="p">,</span> <span class="n">answer</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="Answer


  
      dataclass
   (delphyne.core.refs.Answer)" href="#delphyne.Answer">Answer</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Ensure that a given query answer is present in the trace, even
it is is not used to reach a node.</p>


            <details class="quote">
              <summary>Source code in <code>src/delphyne/core/traces.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">trace_answer</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">space</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">GlobalSpacePath</span><span class="p">,</span> <span class="n">answer</span><span class="p">:</span> <span class="n">refs</span><span class="o">.</span><span class="n">Answer</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ensure that a given query answer is present in the trace, even</span>
<span class="sd">    it is is not used to reach a node.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="o">.</span><span class="n">convert_answer_ref</span><span class="p">((</span><span class="n">space</span><span class="p">,</span> <span class="n">answer</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="delphyne.Tracer.log" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">log</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">log</span><span class="p">(</span><span class="n">message</span><span class="p">:</span> <span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n">metadata</span><span class="p">:</span> <span class="n"><span title="dict">dict</span></span><span class="p">[</span><span class="n"><span title="str">str</span></span><span class="p">,</span> <span class="n"><span title="typing.Any">Any</span></span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">location</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="Location


  
      dataclass
   (delphyne.core.traces.Location)" href="#delphyne.core.traces.Location">Location</a></span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Log a message, with optional metadata and location information.
The metadata must be a dictionary of JSON values.</p>


            <details class="quote">
              <summary>Source code in <code>src/delphyne/core/traces.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">log</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">location</span><span class="p">:</span> <span class="n">Location</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Log a message, with optional metadata and location information.</span>
<span class="sd">    The metadata must be a dictionary of JSON values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
        <span class="n">short_location</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">location</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">short_location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="o">.</span><span class="n">convert_location</span><span class="p">(</span><span class="n">location</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">LogMessage</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span> <span class="n">short_location</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="delphyne.Tracer.export_log" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">export_log</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">export_log</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><span title="collections.abc.Iterable">Iterable</span></span><span class="p">[</span><span class="n"><a class="autorefs autorefs-internal" title="ExportableLogMessage


  
      dataclass
   (delphyne.core.traces.ExportableLogMessage)" href="#delphyne.ExportableLogMessage">ExportableLogMessage</a></span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Export the log into an easily serializable format.</p>


            <details class="quote">
              <summary>Source code in <code>src/delphyne/core/traces.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">export_log</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">ExportableLogMessage</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Export the log into an easily serializable format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">messages</span><span class="p">:</span>
            <span class="n">node</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">space</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">loc</span> <span class="o">:=</span> <span class="n">m</span><span class="o">.</span><span class="n">location</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">node</span> <span class="o">=</span> <span class="n">loc</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">id</span>
                <span class="k">if</span> <span class="n">loc</span><span class="o">.</span><span class="n">space</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">space</span> <span class="o">=</span> <span class="n">pprint</span><span class="o">.</span><span class="n">space_ref</span><span class="p">(</span><span class="n">loc</span><span class="o">.</span><span class="n">space</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">ExportableLogMessage</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">message</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">space</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">metadata</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="delphyne.Tracer.export_trace" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">export_trace</span>


</h4>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">export_trace</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n"><a class="autorefs autorefs-internal" title="ExportableTrace


  
      dataclass
   (delphyne.core.traces.ExportableTrace)" href="#delphyne.core.traces.ExportableTrace">ExportableTrace</a></span>
</code></pre></div>

    <div class="doc doc-contents ">

        <p>Export the trace into an easily serializable format.</p>


            <details class="quote">
              <summary>Source code in <code>src/delphyne/core/traces.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">export_trace</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ExportableTrace</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Export the trace into an easily serializable format.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">lock</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">trace</span><span class="o">.</span><span class="n">export</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="delphyne.LogMessage" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">LogMessage</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


    <div class="doc doc-contents first">


        <p>A log message.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="delphyne.LogMessage.message">message</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The message to log.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="delphyne.LogMessage.metadata">metadata</span></code></td>
            <td>
                  <code><span title="dict">dict</span>[<span title="str">str</span>, <span title="typing.Any">Any</span>] | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Optional metadata associated with the message, as a
dictionary mapping string keys to JSON values.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="delphyne.LogMessage.location">location</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ShortLocation


  
      dataclass
   (delphyne.core.traces.ShortLocation)" href="#delphyne.core.traces.ShortLocation">ShortLocation</a> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An optional location in the strategy tree where the
message was logged, if applicable.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>src/delphyne/core/traces.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">LogMessage</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A log message.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        message: The message to log.</span>
<span class="sd">        metadata: Optional metadata associated with the message, as a</span>
<span class="sd">            dictionary mapping string keys to JSON values.</span>
<span class="sd">        location: An optional location in the strategy tree where the</span>
<span class="sd">            message was logged, if applicable.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">message</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">location</span><span class="p">:</span> <span class="n">ShortLocation</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h3 id="delphyne.ExportableLogMessage" class="doc doc-heading">
            <span class="doc doc-object-name doc-class-name">ExportableLogMessage</span>


  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

</h3>


    <div class="doc doc-contents first">


        <p>An exportable log message, as a dataclass whose fields are JSON
values (as opposed to <a class="autorefs autorefs-internal" title="LogMessage


  
      dataclass
  " href="#delphyne.LogMessage"><code>LogMessage</code></a>) and is thus easier to export.</p>








              <details class="quote">
                <summary>Source code in <code>src/delphyne/core/traces.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span><span class="p">(</span><span class="n">frozen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">ExportableLogMessage</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    An exportable log message, as a dataclass whose fields are JSON</span>
<span class="sd">    values (as opposed to `LogMessage`) and is thus easier to export.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">message</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">node</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span>
    <span class="n">space</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span>
    <span class="n">metadata</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="delphyne.tracer_hook" class="doc doc-heading">
            <span class="doc doc-object-name doc-function-name">tracer_hook</span>


</h3>
<div class="doc-signature highlight"><pre><span></span><code><span class="nf">tracer_hook</span><span class="p">(</span><span class="n">tracer</span><span class="p">:</span> <span class="n"><a class="autorefs autorefs-internal" title="Tracer (delphyne.core.traces.Tracer)" href="#delphyne.Tracer">Tracer</a></span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n"><span title="collections.abc.Callable">Callable</span></span><span class="p">[[</span><span class="n"><a class="autorefs autorefs-internal" title="Tree


  
      dataclass
   (delphyne.core.trees.Tree)" href="../trees/#delphyne.Tree">Tree</a></span><span class="p">[</span><span class="n"><span title="typing.Any">Any</span></span><span class="p">,</span> <span class="n"><span title="typing.Any">Any</span></span><span class="p">,</span> <span class="n"><span title="typing.Any">Any</span></span><span class="p">]],</span> <span class="kc">None</span><span class="p">]</span>
</code></pre></div>

    <div class="doc doc-contents first">

        <p>Standard hook to be passed to <a class="autorefs autorefs-internal" title="TreeMonitor


  
      dataclass
  " href="../strategies/#delphyne.TreeMonitor"><code>TreeMonitor</code></a> to automatically log
visited nodes into a trace.</p>


            <details class="quote">
              <summary>Source code in <code>src/delphyne/core/traces.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">tracer_hook</span><span class="p">(</span><span class="n">tracer</span><span class="p">:</span> <span class="n">Tracer</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">Tree</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Any</span><span class="p">]],</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Standard hook to be passed to `TreeMonitor` to automatically log</span>
<span class="sd">    visited nodes into a trace.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="k">lambda</span> <span class="n">tree</span><span class="p">:</span> <span class="n">tracer</span><span class="o">.</span><span class="n">trace_node</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">ref</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.annotate", "content.code.copy", "content.tabs.link", "navigation.indexes"], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
        <script src="../../../javascript/katex.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/katex.min.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/contrib/auto-render.min.js"></script>
      
    
  </body>
</html>